//
// alasql.js
// Alasql - JavaScript SQL database
// Date: 03.11.2014
// Version: 0.0.6
// (Ã±) 2014, Andrey Gershun
//

/*
The MIT License (MIT)

Copyright (c) 2014 Andrey Gershun (agershun@gmail.com)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

//  UMD header
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define([], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory(require('es6-promise').Promise);
    } else {
        root.alasql = factory(root.Promise);
    }
}(this, function (Promise) {



/* parser generated by jison 0.4.15 */
/*
  Returns a Parser object of the following structure:

  Parser: {
    yy: {}
  }

  Parser.prototype: {
    yy: {},
    trace: function(),
    symbols_: {associative list: name ==> number},
    terminals_: {associative list: number ==> name},
    productions_: [...],
    performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$),
    table: [...],
    defaultActions: {...},
    parseError: function(str, hash),
    parse: function(input),

    lexer: {
        EOF: 1,
        parseError: function(str, hash),
        setInput: function(input),
        input: function(),
        unput: function(str),
        more: function(),
        less: function(n),
        pastInput: function(),
        upcomingInput: function(),
        showPosition: function(),
        test_match: function(regex_match_array, rule_index),
        next: function(),
        lex: function(),
        begin: function(condition),
        popState: function(),
        _currentRules: function(),
        topState: function(),
        pushState: function(condition),

        options: {
            ranges: boolean           (optional: true ==> token location info will include a .range[] member)
            flex: boolean             (optional: true ==> flex-like lexing behaviour where the rules are tested exhaustively to find the longest match)
            backtrack_lexer: boolean  (optional: true ==> lexer regexes are tested in order and for each matching regex the action code is invoked; the lexer terminates the scan when a token is returned by the action code)
        },

        performAction: function(yy, yy_, $avoiding_name_collisions, YY_START),
        rules: [...],
        conditions: {associative list: name ==> set},
    }
  }


  token location info (@$, _$, etc.): {
    first_line: n,
    last_line: n,
    first_column: n,
    last_column: n,
    range: [start_number, end_number]       (where the numbers are indexes into the input string, regular zero-based)
  }


  the parseError function receives a 'hash' object with these members for lexer and parser errors: {
    text:        (matched text)
    token:       (the produced terminal token, if any)
    line:        (yylineno)
  }
  while parser (grammar) errors will also provide these members, i.e. parser errors deliver a superset of attributes: {
    loc:         (yylloc)
    expected:    (string describing the set of expected tokens)
    recoverable: (boolean: TRUE when the parser has a error recovery rule available for this particular error)
  }
*/
var parser = (function(){
var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,18],$V1=[1,13],$V2=[1,14],$V3=[1,12],$V4=[1,15],$V5=[1,16],$V6=[1,17],$V7=[5,31,151,155,156,162,187,188],$V8=[5,7,31,151,155,156,162,187,188],$V9=[5,7,31,40,46,67,68,78,79,80,81,87,151,155,156,162,187,188],$Va=[1,26],$Vb=[45,47,91,92,95,106,107,108,109,110,111,112,114,115,116,117,118,119,120,121,122,132,145],$Vc=[2,23],$Vd=[1,36],$Ve=[5,7,31,46,67,68,78,79,80,81,87,151,155,156,162,187,188],$Vf=[5,7,31,40,44,45,46,47,48,53,55,56,57,58,59,60,61,62,63,65,67,68,78,79,80,81,87,151,152,155,156,157,162,187,188,189,191],$Vg=[1,69],$Vh=[1,66],$Vi=[1,70],$Vj=[1,72],$Vk=[1,71],$Vl=[1,82],$Vm=[1,83],$Vn=[1,84],$Vo=[1,85],$Vp=[1,86],$Vq=[1,87],$Vr=[1,88],$Vs=[1,73],$Vt=[1,74],$Vu=[1,75],$Vv=[1,76],$Vw=[1,80],$Vx=[1,77],$Vy=[1,78],$Vz=[1,79],$VA=[1,81],$VB=[1,68],$VC=[1,67],$VD=[5,7,31,46,68,78,79,80,81,87,151,155,156,162,187,188],$VE=[1,94],$VF=[1,103],$VG=[5,7,31,38,40,46,67,68,78,79,80,81,87,151,155,156,162,187,188],$VH=[1,113],$VI=[5,7,31,38,40,44,46,67,68,78,79,80,81,87,151,155,156,162,187,188],$VJ=[1,118],$VK=[1,115],$VL=[1,116],$VM=[1,117],$VN=[1,119],$VO=[1,120],$VP=[1,121],$VQ=[1,122],$VR=[1,123],$VS=[1,124],$VT=[1,125],$VU=[1,126],$VV=[1,128],$VW=[1,129],$VX=[1,131],$VY=[1,130],$VZ=[1,132],$V_=[1,133],$V$=[5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,95,125,127,128,129,130,131,132,133,134,135,136,137,138,139,140,143,144,145,146,147,148,151,155,156,162,187,188],$V01=[2,101],$V11=[1,137],$V21=[5,7,31,38,40,44,46,47,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,95,125,127,128,129,130,131,132,133,134,135,136,137,138,139,140,143,144,145,146,147,148,151,155,156,162,187,188],$V31=[1,148],$V41=[5,7,31,46,78,79,80,81,87,151,155,156,162,187,188],$V51=[5,7,31,44,46,67,68,78,79,80,81,87,151,155,156,162,187,188],$V61=[2,45],$V71=[1,156],$V81=[1,157],$V91=[1,159],$Va1=[1,158],$Vb1=[1,160],$Vc1=[1,161],$Vd1=[1,162],$Ve1=[1,163],$Vf1=[5,7,31,44,46,53,55,56,57,58,59,60,61,62,67,68,78,79,80,81,87,151,155,156,162,187,188],$Vg1=[1,170],$Vh1=[5,7,31,44,67,151,155,156,162,187,188],$Vi1=[5,7,31,44,46,53,55,56,57,58,59,60,61,62,67,68,78,79,80,81,87,139,151,155,156,162,187,188],$Vj1=[35,149,150],$Vk1=[5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,130,131,132,135,136,137,138,139,140,143,144,145,146,147,148,151,155,156,162,187,188],$Vl1=[2,141],$Vm1=[1,222],$Vn1=[125,127,129],$Vo1=[5,7,31,46,78,79,80,87,151,155,156,162,187,188],$Vp1=[5,7,31,46,53,55,56,57,58,59,60,61,62,67,68,78,79,80,81,87,151,155,156,162,187,188],$Vq1=[1,236],$Vr1=[1,240],$Vs1=[1,249],$Vt1=[5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,135,136,137,138,139,140,143,144,147,148,151,155,156,162,187,188],$Vu1=[5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,144,147,148,151,155,156,162,187,188],$Vv1=[1,257],$Vw1=[44,46],$Vx1=[2,98],$Vy1=[5,7,31,46,78,79,80,151,155,156,162,187,188],$Vz1=[1,270],$VA1=[1,271],$VB1=[1,272],$VC1=[1,279],$VD1=[1,299],$VE1=[5,7,31,46,151,155,156,162,187,188],$VF1=[1,312],$VG1=[5,7,31,44,46,77,78,79,80,81,87,151,155,156,162,187,188],$VH1=[5,7,31,44,151,155,156,162,187,188],$VI1=[5,7,31,44,46,151,155,156,162,187,188],$VJ1=[5,7,31,44,46,145,151,155,156,162,177,180,187,188],$VK1=[5,7,31,44,46,78,79,80,87,151,155,156,162,187,188],$VL1=[177,180],$VM1=[2,212],$VN1=[1,357],$VO1=[1,390],$VP1=[1,394];
var parser = {trace: function trace() { },
yy: {},
symbols_: {"error":2,"main":3,"Statements":4,"EOF":5,"Statement":6,"SEMICOLON":7,"ExplainStatement":8,"EXPLAIN":9,"QUERY":10,"PLAN":11,"Select":12,"Insert":13,"Update":14,"Delete":15,"CreateTable":16,"DropTable":17,"AlterTable":18,"WithSelectClause":19,"WITH":20,"WithTables":21,"RECURSIVE":22,"SelectClause":23,"IntoClause":24,"FromClause":25,"WhereClause":26,"GroupClause":27,"OrderClause":28,"LimitClause":29,"UnionClause":30,"SELECT":31,"DISTINCT":32,"TopClause":33,"ResultColumns":34,"ALL":35,"TOP":36,"NumValue":37,"INTO":38,"Table":39,"FROM":40,"FromTablesList":41,"FromTable":42,"JoinTablesList":43,"COMMA":44,"LPAR":45,"RPAR":46,"LITERAL":47,"AS":48,"ParamValue":49,"DOT":50,"JoinTable":51,"JoinMode":52,"JOIN":53,"OnClause":54,"INNER":55,"LEFT":56,"OUTER":57,"RIGHT":58,"FULL":59,"SEMI":60,"ANTI":61,"CROSS":62,"ON":63,"Expression":64,"USING":65,"ColumnsList":66,"WHERE":67,"GROUP":68,"BY":69,"GroupExpressionsList":70,"HavingClause":71,"GroupExpression":72,"GROUPING":73,"SETS":74,"ROLLUP":75,"CUBE":76,"HAVING":77,"UNION":78,"EXCEPT":79,"INTERSECT":80,"ORDER":81,"OrderExpressionsList":82,"OrderExpression":83,"DIRECTION":84,"COLLATE":85,"NOCASE":86,"LIMIT":87,"OffsetClause":88,"OFFSET":89,"ResultColumn":90,"LBRA":91,"NUMBER":92,"RBRA":93,"Star":94,"STAR":95,"Column":96,"AggrValue":97,"FuncValue":98,"Op":99,"LogicValue":100,"StringValue":101,"NullValue":102,"ExistsValue":103,"CaseValue":104,"Aggregator":105,"SUM":106,"COUNT":107,"MIN":108,"MAX":109,"AVG":110,"FIRST":111,"LAST":112,"ExprList":113,"TRUE":114,"FALSE":115,"STRING":116,"NULL":117,"EXISTS":118,"DOLLAR":119,"COLON":120,"QUESTION":121,"CASE":122,"WhensList":123,"ElseClause":124,"END":125,"When":126,"WHEN":127,"THEN":128,"ELSE":129,"LIKE":130,"PLUS":131,"MINUS":132,"SLASH":133,"PERCENT":134,"GT":135,"GE":136,"LT":137,"LE":138,"EQ":139,"NE":140,"CondOp":141,"AllSome":142,"AND":143,"OR":144,"NOT":145,"IN":146,"BETWEEN":147,"NOT_BETWEEN":148,"SOME":149,"ANY":150,"UPDATE":151,"SET":152,"SetColumnsList":153,"SetColumn":154,"DELETE":155,"INSERT":156,"VALUES":157,"ValuesListsList":158,"ValuesList":159,"Value":160,"DateValue":161,"CREATE":162,"TemporaryClause":163,"TABLE":164,"IfNotExists":165,"CreateTableDefClause":166,"TEMPORARY":167,"TEMP":168,"IF":169,"ColumnDefsList":170,"ConstraintsList":171,"Constraint":172,"ConstraintName":173,"PrimaryKey":174,"ForeignKey":175,"CONSTRAINT":176,"PRIMARY":177,"KEY":178,"ColsList":179,"FOREIGN":180,"REFERENCES":181,"ColumnDef":182,"ColumnTypeName":183,"ColumnConstraint":184,"ColumnConstraints":185,"SignedNumber":186,"DROP":187,"ALTER":188,"RENAME":189,"TO":190,"ADD":191,"COLUMN":192,"$accept":0,"$end":1},
terminals_: {2:"error",5:"EOF",7:"SEMICOLON",9:"EXPLAIN",10:"QUERY",11:"PLAN",20:"WITH",22:"RECURSIVE",31:"SELECT",32:"DISTINCT",35:"ALL",36:"TOP",38:"INTO",40:"FROM",44:"COMMA",45:"LPAR",46:"RPAR",47:"LITERAL",48:"AS",50:"DOT",53:"JOIN",55:"INNER",56:"LEFT",57:"OUTER",58:"RIGHT",59:"FULL",60:"SEMI",61:"ANTI",62:"CROSS",63:"ON",65:"USING",67:"WHERE",68:"GROUP",69:"BY",73:"GROUPING",74:"SETS",75:"ROLLUP",76:"CUBE",77:"HAVING",78:"UNION",79:"EXCEPT",80:"INTERSECT",81:"ORDER",84:"DIRECTION",85:"COLLATE",86:"NOCASE",87:"LIMIT",89:"OFFSET",91:"LBRA",92:"NUMBER",93:"RBRA",95:"STAR",106:"SUM",107:"COUNT",108:"MIN",109:"MAX",110:"AVG",111:"FIRST",112:"LAST",114:"TRUE",115:"FALSE",116:"STRING",117:"NULL",118:"EXISTS",119:"DOLLAR",120:"COLON",121:"QUESTION",122:"CASE",125:"END",127:"WHEN",128:"THEN",129:"ELSE",130:"LIKE",131:"PLUS",132:"MINUS",133:"SLASH",134:"PERCENT",135:"GT",136:"GE",137:"LT",138:"LE",139:"EQ",140:"NE",143:"AND",144:"OR",145:"NOT",146:"IN",147:"BETWEEN",148:"NOT_BETWEEN",149:"SOME",150:"ANY",151:"UPDATE",152:"SET",155:"DELETE",156:"INSERT",157:"VALUES",161:"DateValue",162:"CREATE",164:"TABLE",167:"TEMPORARY",168:"TEMP",169:"IF",176:"CONSTRAINT",177:"PRIMARY",178:"KEY",180:"FOREIGN",181:"REFERENCES",185:"ColumnConstraints",186:"SignedNumber",187:"DROP",188:"ALTER",189:"RENAME",190:"TO",191:"ADD",192:"COLUMN"},
productions_: [0,[3,2],[4,2],[4,2],[4,1],[8,2],[8,4],[6,1],[6,1],[6,1],[6,1],[6,1],[6,1],[6,1],[19,3],[19,4],[19,1],[21,0],[12,8],[23,4],[23,4],[23,3],[33,2],[33,0],[24,0],[24,2],[25,2],[25,3],[25,0],[41,1],[41,3],[42,4],[42,5],[42,3],[42,2],[42,3],[42,1],[42,2],[42,3],[42,1],[39,3],[39,1],[43,2],[43,1],[51,4],[52,0],[52,1],[52,1],[52,2],[52,1],[52,2],[52,1],[52,2],[52,1],[52,1],[52,1],[54,2],[54,2],[54,0],[26,0],[26,2],[27,0],[27,4],[70,1],[70,3],[72,5],[72,4],[72,4],[72,1],[71,0],[71,2],[30,0],[30,2],[30,3],[30,2],[30,2],[28,0],[28,3],[82,1],[82,3],[83,1],[83,2],[83,3],[83,4],[29,0],[29,3],[88,0],[88,2],[34,3],[34,1],[90,3],[90,5],[90,3],[90,1],[94,5],[94,3],[94,1],[96,5],[96,3],[96,4],[96,3],[96,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[64,1],[97,4],[105,1],[105,1],[105,1],[105,1],[105,1],[105,1],[105,1],[98,4],[98,3],[113,1],[113,3],[37,1],[100,1],[100,1],[101,1],[102,1],[103,4],[49,2],[49,2],[49,1],[104,5],[104,4],[123,2],[123,1],[126,4],[124,2],[124,0],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,3],[99,6],[99,6],[99,3],[99,3],[99,2],[99,2],[99,3],[99,5],[99,6],[99,5],[99,6],[99,3],[99,3],[141,1],[141,1],[141,1],[141,1],[141,1],[141,1],[142,1],[142,1],[142,1],[14,6],[14,4],[153,1],[153,3],[154,3],[15,5],[15,3],[13,5],[13,8],[13,4],[13,7],[158,3],[158,5],[159,1],[159,3],[160,1],[160,1],[160,1],[160,1],[160,1],[160,1],[66,1],[66,3],[16,8],[163,0],[163,1],[163,1],[165,0],[165,3],[166,3],[166,1],[166,2],[171,1],[171,3],[172,2],[172,2],[173,0],[173,2],[174,5],[175,10],[179,1],[179,3],[170,1],[170,3],[182,3],[182,2],[183,6],[183,4],[183,1],[184,0],[184,2],[184,7],[184,2],[17,5],[17,3],[18,6],[18,6]],
performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate /* action[1] */, $$ /* vstack */, _$ /* lstack */) {
/* this == yyval */

var $0 = $$.length - 1;
switch (yystate) {
case 1:
 return new yy.Statements({statements:$$[$0-1]}); 
break;
case 2:
 this.$ = $$[$0-1]; $$[$0-1].push($$[$01]); 
break;
case 3: case 187:
 this.$ = [$$[$0-1]]; 
break;
case 4: case 29: case 43: case 63: case 78: case 89: case 124: case 138: case 178: case 189: case 197:
 this.$ = [$$[$0]]; 
break;
case 5:
 this.$ = $$[$0]; $$[$0].explain = true; 
break;
case 6:
 this.$ = $$[$0];  $$[$0].explain = true;
break;
case 14: case 15: case 36: case 68: case 93: case 102: case 103: case 104: case 105: case 106: case 107: case 108: case 109: case 110: case 111: case 112: case 113: case 140: case 167: case 168: case 169: case 170: case 171: case 172:
 this.$ = $$[$0]; 
break;
case 16:
 this.$ = $$[$0];
break;
case 18:
   yy.extend(this.$,$$[$0-7]); yy.extend(this.$,$$[$0-5]); yy.extend(this.$,$$[$0-4]); 
		    yy.extend(this.$,$$[$0-3]); yy.extend(this.$,$$[$0-2]);yy.extend(this.$,$$[$0-1]); 
		    yy.extend(this.$,$$[$0]); 
		    this.$ = $$[$0-7];
		    if(yy.exists) this.$.exists = yy.exists;
		    delete yy.exists;
		    if(yy.queries) this.$.queries = yy.queries;
			delete yy.queries;
		
break;
case 19:
 this.$ = new yy.Select({ columns:$$[$0], distinct: true }); yy.extend(this.$, $$[$0-1]); 
break;
case 20:
 this.$ = new yy.Select({ columns:$$[$0], all:true }); yy.extend(this.$, $$[$0-1]); 
break;
case 21:
 this.$ = new yy.Select({ columns:$$[$0] }); yy.extend(this.$, $$[$0-1]); 
break;
case 22:
 this.$ = {top: $$[$0]}; 
break;
case 23: case 28: case 58: case 59: case 61: case 69: case 71: case 76: case 84: case 86: case 200: case 203: case 232:
 this.$ = null; 
break;
case 24: case 225:
this.$ = null
break;
case 25:
this.$ = $$[$0]
break;
case 26:
 this.$ = { from: $$[$0] }; 
break;
case 27:
 this.$ = { from: [$$[$0-1]], joins: $$[$0] }; 
break;
case 30: case 64: case 179:
 this.$ = $$[$0-2]; $$[$0-2].push($$[$0]); 
break;
case 31:
 this.$ = $$[$0-2]; this.$.as = $$[$0] 
break;
case 32:
 this.$ = $$[$0-3]; this.$.as = $$[$0] 
break;
case 33:
 this.$ = $$[$0-1]; this.$.as = 'default' 
break;
case 34:
 this.$ = $$[$0-1]; $$[$0-1].as = $$[$0] 
break;
case 35:
 this.$ = $$[$0-2]; $$[$0-2].as = $$[$0] 
break;
case 37:
 this.$ = $$[$0-1]; $$[$0-1].as = $$[$0]; 
break;
case 38:
 this.$ = $$[$0-2]; $$[$0-2].as = $$[$0]; 
break;
case 39:
 this.$ = $$[$0]; $$[$0].as = 'delault'; 
break;
case 40:
 this.$ = new yy.Table({databaseid: $$[$0-2].toLowerCase(), tableid:$$[$0].toLowerCase()});
break;
case 41:
 this.$ = new yy.Table({tableid: $$[$0].toLowerCase()});
break;
case 42:
 this.$ = $$[$0-1]; $$[$0-1].push($$[$0]); 
break;
case 44:
 this.$ = new yy.Join({table:$$[$0-1], joinmode: $$[$0-3]}); yy.extend(this.$, $$[$0]); 
break;
case 45: case 46:
 this.$ = "INNER"; 
break;
case 47: case 48:
 this.$ = "LEFT"; 
break;
case 49: case 50:
 this.$ = "RIGHT"; 
break;
case 51: case 52:
 this.$ = "OUTER"; 
break;
case 53:
 this.$ = "SEMI"; 
break;
case 54:
 this.$ = "ANTI"; 
break;
case 55:
 
			this.$ = "INNER"; 
			// this.$ = "CROSS"; // TODO: Change in code
		
break;
case 56:
 this.$ = {on: $$[$0]}; 
break;
case 57:
 this.$ = {using: $$[$0]}; 
break;
case 60:
 this.$ = {where: new yy.Expression({expression:$$[$0]})}; 
break;
case 62:
 this.$ = {group:$$[$0-1]}; yy.extend(this.$,$$[$0]); 
break;
case 65:
 this.$ = new yy.GroupExpression({type:'GROUPING SETS', group: $$[$0-1]}); 
break;
case 66:
 this.$ = new yy.GroupExpression({type:'ROLLUP', group: $$[$0-1]}); 
break;
case 67:
 this.$ = new yy.GroupExpression({type:'CUBE', group: $$[$0-1]}); 
break;
case 70:
 this.$ = {having:$$[$0]}
break;
case 72:
 this.$ = {union: $$[$0]} ; 
break;
case 73:
 this.$ = {unionall: $$[$0]} ; 
break;
case 74:
 this.$ = {except: $$[$0]} ; 
break;
case 75:
 this.$ = {intersect: $$[$0]} ; 
break;
case 77:
 this.$ = {order:$$[$0]}
break;
case 79:
 this.$ = $$[$0-2]; $$[$0-2].push($$[$0])
break;
case 80:
 this.$ = new yy.OrderExpression({expression: $$[$0], direction:'ASC'}) 
break;
case 81:
 this.$ = new yy.OrderExpression({expression: $$[$0-1], direction:$$[$0].toUpperCase()}) 
break;
case 82:
 this.$ = new yy.OrderExpression({expression: $$[$0-2], direction:'ASC', nocase:true}) 
break;
case 83:
 this.$ = new yy.OrderExpression({expression: $$[$0-3], direction:$$[$0].toUpperCase(), nocase:true}) 
break;
case 85:
 this.$ = {limit:$$[$0-1]}; yy.extend(this.$, $$[$0])
break;
case 87:
 this.$ = {offset:$$[$0]}
break;
case 88: case 209: case 219:
 $$[$0-2].push($$[$0]); this.$ = $$[$0-2]; 
break;
case 90:
 $$[$0-2].as = $$[$0].toLowerCase(); this.$ = $$[$0-2];
break;
case 91:
 $$[$0-4].as = $$[$0-1]; this.$ = $$[$0-4];
break;
case 92:
 $$[$0-2].as = $$[$0]; this.$ = $$[$0-2];
break;
case 94:
 this.$ = new yy.Column({columid: $$[$0], tableid: $$[$0-2].toLowerCase(), databaseid:$$[$0-4]}); 
break;
case 95:
 this.$ = new yy.Column({columnid: $$[$0], tableid: $$[$0-2].toLowerCase()}); 
break;
case 96:
 this.$ = new yy.Column({columnid:$$[$0]}); 
break;
case 97:
 this.$ = new yy.Column({columnid: $$[$0].toLowerCase(), tableid: $$[$0-2].toLowerCase(), databaseid:$$[$0-4].toLowerCase()});
break;
case 98:
 this.$ = new yy.Column({columnid: $$[$0].toLowerCase(), tableid: $$[$0-2].toLowerCase()});
break;
case 99:
 this.$ = new yy.Column({columnid: $$[$0-1], tableid: $$[$0-3].toLowerCase()});
break;
case 100:
 this.$ = new yy.Column({columnid: $$[$0-1]});
break;
case 101:
 this.$ = new yy.Column({columnid: $$[$0].toLowerCase()});
break;
case 114:
 this.$ = new yy.AggrValue({aggregatorid: $$[$0-3].toUpperCase(), expression: $$[$0-1]}); 
break;
case 115:
 this.$ = "SUM"; 
break;
case 116:
 this.$ = "COUNT"; 
break;
case 117:
 this.$ = "MIN"; 
break;
case 118:
 this.$ = "MAX"; 
break;
case 119:
 this.$ = "AVG"; 
break;
case 120:
 this.$ = "FIRST"; 
break;
case 121:
 this.$ = "LAST"; 
break;
case 122:
 this.$ = new yy.FuncValue({funcid: "_"+$$[$0-3].toLowerCase(), args: $$[$0-1]}); 
break;
case 123:
 this.$ = new yy.FuncValue({ funcid: "_"+$$[$0-2].toLowerCase() }) 
break;
case 125:
 $$[$0-2].push($$[$0]); this.$ = $$[$0-2] 
break;
case 126:
 this.$ = new yy.NumValue({value:$$[$0]}); 
break;
case 127:
 this.$ = new yy.LogicValue({value:true}); 
break;
case 128:
 this.$ = new yy.LogicValue({value:false}); 
break;
case 129:
 this.$ = new yy.StringValue({value: $$[$0].substr(1,$$[$0].length-2).replace(/\'\'/g,"'")}); 
break;
case 130:
 this.$ = new yy.NullValue({value:null}); 
break;
case 131:
 
			if(!yy.exists) yy.exists = [];
			this.$ = new yy.ExistsValue({value:$$[$0-1], existsidx:yy.exists.length}); 
			yy.exists.push($$[$0-1]);
		
break;
case 132: case 133:
 this.$ = new yy.ParamValue({param: $$[$0].toLowerCase()}); 
break;
case 134:
 
			if(typeof yy.question == 'undefined') yy.question = 0; 
			this.$ = new yy.ParamValue({param: yy.question++}); 
		
break;
case 135:
 this.$ = new yy.CaseValue({expression:$$[$0-3], whens: $$[$0-2], elses: $$[$0-1]}); 
break;
case 136:
 this.$ = new yy.CaseValue({whens: $$[$0-2], elses: $$[$0-1]}); 
break;
case 137:
 this.$ = $$[$0-1]; this.$.push($$[$0]); 
break;
case 139:
 this.$ = {when: $$[$0-2], then: $$[$0] }; 
break;
case 141:
this.$ = null; 
break;
case 142:
 this.$ = new yy.Op({left:$$[$0-2], op:'LIKE', right:$$[$0]}); 
break;
case 143:
 this.$ = new yy.Op({left:$$[$0-2], op:'+', right:$$[$0]}); 
break;
case 144:
 this.$ = new yy.Op({left:$$[$0-2], op:'-', right:$$[$0]}); 
break;
case 145:
 this.$ = new yy.Op({left:$$[$0-2], op:'*', right:$$[$0]}); 
break;
case 146:
 this.$ = new yy.Op({left:$$[$0-2], op:'/', right:$$[$0]}); 
break;
case 147:
 this.$ = new yy.Op({left:$$[$0-2], op:'%', right:$$[$0]}); 
break;
case 148:
 this.$ = new yy.Op({left:$$[$0-2], op:'>' , right:$$[$0]}); 
break;
case 149:
 this.$ = new yy.Op({left:$$[$0-2], op:'>=' , right:$$[$0]}); 
break;
case 150:
 this.$ = new yy.Op({left:$$[$0-2], op:'<' , right:$$[$0]}); 
break;
case 151:
 this.$ = new yy.Op({left:$$[$0-2], op:'<=' , right:$$[$0]}); 
break;
case 152:
 this.$ = new yy.Op({left:$$[$0-2], op:'=' , right:$$[$0]}); 
break;
case 153:
 this.$ = new yy.Op({left:$$[$0-2], op:'!=' , right:$$[$0]}); 
break;
case 154:
 
			if(!yy.queries) yy.queries = []; 
			this.$ = new yy.Op({left:$$[$0-5], op:$$[$0-4] , allsome:$$[$0-3], right:$$[$0-1], queriesidx: yy.queries.length}); 
			yy.queries.push($$[$0-1]);  
		
break;
case 155:
 
			this.$ = new yy.Op({left:$$[$0-5], op:$$[$0-4] , allsome:$$[$0-3], right:$$[$0-1]}); 
		
break;
case 156:
 this.$ = new yy.Op({left:$$[$0-2], op:'AND' , right:$$[$0]}); 
break;
case 157:
 this.$ = new yy.Op({left:$$[$0-2], op:'OR' , right:$$[$0]}); 
break;
case 158:
 this.$ = new yy.UniOp({op:'NOT' , right:$$[$0]}); 
break;
case 159:
 this.$ = new yy.UniOp({op:'-' , right:$$[$0]}); 
break;
case 160:
 this.$ = new yy.UniOp({right: $$[$0-1]}); 
break;
case 161:
 
			if(!yy.queries) yy.queries = []; 
			this.$ = new yy.Op({left: $$[$0-4], op:'IN', right:$$[$0-1], queriesidx: yy.queries.length});
			yy.queries.push($$[$0-1]);  
		
break;
case 162:
 
			if(!yy.queries) yy.queries = []; 
			this.$ = new yy.Op({left: $$[$0-5], op:'NOT IN', right:$$[$0-1], queriesidx: yy.queries.length});
			yy.queries.push($$[$0-1]);  
		
break;
case 163:
 this.$ = new yy.Op({left: $$[$0-4], op:'IN', right:$$[$0-1]}); 
break;
case 164:
 this.$ = new yy.Op({left: $$[$0-5], op:'NOT IN', right:$$[$0-1]}); 
break;
case 165:
 this.$ = new yy.Op({left:$$[$0-2], op:'BETWEEN', right:$$[$0] }); 
break;
case 166:
 this.$ = new yy.Op({left:$$[$0-2], op:'NOT BETWEEN', right:$$[$0] }); 
break;
case 173:
 this.$ = 'ALL'; 
break;
case 174:
 this.$ = 'SOME'; 
break;
case 175:
 this.$ = 'ANY'; 
break;
case 176:
 this.$ = new yy.Update({table:$$[$0-4], columns:$$[$0-2], where:$$[$0]}); 
break;
case 177:
 this.$ = new yy.Update({table:$$[$0-2], columns:$$[$0]}); 
break;
case 180:
 this.$ = new yy.SetColumn({columnid:$$[$0-2], expression:$$[$0]})
break;
case 181:
 this.$ = new yy.Delete({table:$$[$0-2], where:$$[$0]});
break;
case 182:
 this.$ = new yy.Delete({table:$$[$0]});
break;
case 183:
 this.$ = new yy.Insert({into:$$[$0-2], values: $$[$0]}); 
break;
case 184:
 this.$ = new yy.Insert({into:$$[$0-5], columns: $$[$0-3], values: $$[$0]}); 
break;
case 185:
 this.$ = new yy.Insert({into:$$[$0-1], select: $$[$0]}); 
break;
case 186:
 this.$ = new yy.Insert({into:$$[$0-4], columns: $$[$0-2], select: $$[$0]}); 
break;
case 188:
this.$ = $$[$0-4]; $$[$0-4].push($$[$0-1])
break;
case 190: case 198:
this.$ = $$[$0-2]; $$[$0-2].push($$[$0])
break;
case 199:
 
			this.$ = new yy.CreateTable({table:$$[$0-3]}); 
			yy.extend(this.$,$$[$0-6]); 
			yy.extend(this.$,$$[$0-4]); 
			yy.extend(this.$,$$[$0-1]); 
			yy.extend(this.$,$$[$0]);
		
break;
case 201: case 202:
 this.$ = {temporary:true}; 
break;
case 204:
 this.$ = {ifnotexists: true}; 
break;
case 205:
 this.$ = {columns: $$[$0-2], constraints: $$[$0]}; 
break;
case 206:
 this.$ = {columns: $$[$0]}; 
break;
case 207:
 this.$ = {as: $$[$0]} 
break;
case 208: case 218:
 this.$ = [$$[$0]];
break;
case 210: case 211:
 $$[$0].constraintid = $$[$0-1]; this.$ = $$[$0]; 
break;
case 212:
 this.$ = null 
break;
case 213:
 this.$ = $$[$0].toLowerCase(); 
break;
case 214:
 this.$ = {type: 'PRIMARY KEY', columns: $$[$0-1]}; 
break;
case 215:
 this.$ = {type: 'FOREIGN KEY', columns: $$[$0-6].toLowerCase(), tableid: $$[$0-7].toLowerCase(), refcolumns: $$[$0-4]}; 
break;
case 216:
 this.$ = [$$[$0].toLowerCase()]; 
break;
case 217:
 this.$ = $$[$0-2]; $$[$0-2].push($$[$0].toLowerCase()); 
break;
case 220:
 this.$ = new yy.ColumnDef({columnid:$$[$0-2].toLowerCase()}); yy.extend(this.$,$$[$0-1]); yy.extend(this.$,$$[$0]);
break;
case 221:
 this.$ = new yy.ColumnDef({columnid:$$[$0-1].toLowerCase()}); yy.extend(this.$,$$[$0]); 
break;
case 222:
 this.$ = {dbtypeid: $$[$0-5].toUpperCase(), dbsize: $$[$0-3], dbprecision: $$[$0-1]} 
break;
case 223:
 this.$ = {dbtypeid: $$[$0-3].toUpperCase(), dbsize: $$[$0-1]} 
break;
case 224:
 this.$ = {dbtypeid: $$[$0].toUpperCase()} 
break;
case 226:
this.$ = {primarykey:true};
break;
case 227:
this.$ = {foreignkey:{tableid:$$[$0-3].toLowerCase(), columnid: $$[$0-1].toLowerCase()}};
break;
case 228:
this.$ = {notnull:true};
break;
case 229:
 this.$ = new yy.DropTable({table:$$[$0], ifexists:true}); 
break;
case 230:
 this.$ = new yy.DropTable({table:$$[$0]}); 
break;
case 231:
 this.$ = new yy.AlterTable({table:$$[$0-3], renameto: $$[$0].toLowerCase()});
break;
}
},
table: [{3:1,4:2,6:3,12:4,13:5,14:6,15:7,16:8,17:9,18:10,23:11,31:$V0,151:$V1,155:$V2,156:$V3,162:$V4,187:$V5,188:$V6},{1:[3]},{5:[1,19],6:20,12:4,13:5,14:6,15:7,16:8,17:9,18:10,23:11,31:$V0,151:$V1,155:$V2,156:$V3,162:$V4,187:$V5,188:$V6},o($V7,[2,4],{7:[1,21]}),o($V8,[2,7]),o($V8,[2,8]),o($V8,[2,9]),o($V8,[2,10]),o($V8,[2,11]),o($V8,[2,12]),o($V8,[2,13]),o($V9,[2,24],{24:22,38:[1,23]}),{38:[1,24]},{39:25,47:$Va},{40:[1,27]},{163:28,164:[2,200],167:[1,29],168:[1,30]},{164:[1,31]},{164:[1,32]},o($Vb,$Vc,{33:35,32:[1,33],35:[1,34],36:$Vd}),{1:[2,1]},o($V7,[2,2]),o($V7,[2,3]),o($Ve,[2,28],{25:37,40:[1,38]}),{39:39,47:$Va},{39:40,47:$Va},{152:[1,41]},o($Vf,[2,41],{50:[1,42]}),{39:43,47:$Va},{164:[1,44]},{164:[2,201]},{164:[2,202]},{39:46,47:$Va,169:[1,45]},{39:47,47:$Va},o($Vb,$Vc,{33:48,36:$Vd}),o($Vb,$Vc,{33:49,36:$Vd}),{34:50,37:58,45:$Vg,47:$Vh,49:62,64:52,90:51,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:89,92:$Vj},o($VD,[2,59],{26:90,67:[1,91]}),{39:95,41:92,42:93,45:$VE,47:$Va,49:96,119:$Vx,120:$Vy,121:$Vz},o($V9,[2,25]),{12:99,23:11,31:$V0,45:[1,98],157:[1,97]},{47:$VF,91:$Vi,96:102,153:100,154:101},{47:[1,104]},o($V8,[2,182],{67:[1,105]}),{47:[2,203],165:106,169:[1,107]},{118:[1,108]},o($V8,[2,230]),{189:[1,109],191:[1,110]},{34:111,37:58,45:$Vg,47:$Vh,49:62,64:52,90:51,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{34:112,37:58,45:$Vg,47:$Vh,49:62,64:52,90:51,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($VG,[2,21],{44:$VH}),o($VI,[2,89]),o($VI,[2,93],{141:127,48:[1,114],95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($V$,[2,102]),o($V$,[2,103]),o($V$,[2,104]),o($V$,[2,105]),o($V$,[2,106]),o($V$,[2,107]),o($V$,[2,108]),o($V$,[2,109]),o($V$,[2,110]),o($V$,[2,111]),o($V$,[2,112]),o($V$,[2,113]),{45:[1,134]},o($V$,$V01,{45:[1,135],50:[1,136],91:$V11}),{37:58,45:$Vg,47:$Vh,49:62,64:138,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:139,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:140,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{92:[1,141]},o($V$,[2,96]),o([5,7,31,38,40,44,45,46,47,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,89,91,92,95,106,107,108,109,110,111,112,114,115,116,117,118,119,120,121,122,125,127,128,129,130,131,132,133,134,135,136,137,138,139,140,143,144,145,146,147,148,151,155,156,162,187,188],[2,126]),o($V$,[2,127]),o($V$,[2,128]),o($V$,[2,129]),o($V$,[2,130]),{47:[1,142]},{47:[1,143]},o($V21,[2,134]),{45:[1,144]},{37:58,45:$Vg,47:$Vh,49:62,64:145,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,123:146,126:147,127:$V31,132:$VB,145:$VC},{45:[2,115]},{45:[2,116]},{45:[2,117]},{45:[2,118]},{45:[2,119]},{45:[2,120]},{45:[2,121]},o($Vb,[2,22]),o($V41,[2,61],{27:149,68:[1,150]}),{37:58,45:$Vg,47:$Vh,49:62,64:151,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($Ve,[2,26],{44:[1,152]}),o($V51,[2,29],{43:153,51:154,52:155,53:$V61,55:$V71,56:$V81,57:$V91,58:$Va1,59:$Vb1,60:$Vc1,61:$Vd1,62:$Ve1}),{12:164,23:11,31:$V0},o($Vf1,[2,36],{47:[1,165],48:[1,166]}),o($Vf1,[2,39],{47:[1,167],48:[1,168]}),{45:$Vg1,158:169},{47:$VF,66:171,91:$Vi,96:172},o($V8,[2,185]),o($V8,[2,177],{44:[1,174],67:[1,173]}),o($Vh1,[2,178]),{139:[1,175]},o($Vi1,$V01,{50:[1,176],91:$V11}),o($Vf,[2,40]),{37:58,45:$Vg,47:$Vh,49:62,64:177,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{39:178,47:$Va},{145:[1,179]},{39:180,47:$Va},{190:[1,181]},{192:[1,182]},o($VG,[2,19],{44:$VH}),o($VG,[2,20],{44:$VH}),{37:58,45:$Vg,47:$Vh,49:62,64:52,90:183,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{47:[1,184],91:[1,185],92:[1,186]},{37:58,45:$Vg,47:$Vh,49:62,64:187,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:188,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:189,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:190,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:191,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:192,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($Vj1,[2,167],{97:53,98:54,99:55,96:56,94:57,37:58,100:59,101:60,102:61,49:62,103:63,104:64,105:65,64:193,45:$Vg,47:$Vh,91:$Vi,92:$Vj,95:$Vk,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC}),o($Vj1,[2,168],{97:53,98:54,99:55,96:56,94:57,37:58,100:59,101:60,102:61,49:62,103:63,104:64,105:65,64:194,45:$Vg,47:$Vh,91:$Vi,92:$Vj,95:$Vk,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC}),o($Vj1,[2,169],{97:53,98:54,99:55,96:56,94:57,37:58,100:59,101:60,102:61,49:62,103:63,104:64,105:65,64:195,45:$Vg,47:$Vh,91:$Vi,92:$Vj,95:$Vk,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC}),o($Vj1,[2,170],{97:53,98:54,99:55,96:56,94:57,37:58,100:59,101:60,102:61,49:62,103:63,104:64,105:65,64:196,45:$Vg,47:$Vh,91:$Vi,92:$Vj,95:$Vk,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC}),o($Vj1,[2,171],{97:53,98:54,99:55,96:56,94:57,37:58,100:59,101:60,102:61,49:62,103:63,104:64,105:65,64:197,45:$Vg,47:$Vh,91:$Vi,92:$Vj,95:$Vk,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC}),o($Vj1,[2,172],{97:53,98:54,99:55,96:56,94:57,37:58,100:59,101:60,102:61,49:62,103:63,104:64,105:65,64:198,45:$Vg,47:$Vh,91:$Vi,92:$Vj,95:$Vk,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC}),{35:[1,200],142:199,149:[1,201],150:[1,202]},{37:58,45:$Vg,47:$Vh,49:62,64:203,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:204,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{45:[1,205]},{146:[1,206]},{37:58,45:$Vg,47:$Vh,49:62,64:207,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:208,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:209,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,46:[1,211],47:$Vh,49:62,64:212,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,113:210,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{47:[1,213],95:[1,214]},{92:[1,215]},o([5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,135,136,137,138,139,140,143,144,145,146,147,148,151,155,156,162,187,188],[2,158],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO}),o($Vk1,[2,159],{141:127,95:$VJ,133:$VN,134:$VO}),{46:[1,216],95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,141:127,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_},{93:[1,217]},o($V21,[2,132]),o($V21,[2,133]),{12:218,23:11,31:$V0},{95:$VJ,123:219,126:147,127:$V31,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,141:127,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_},{124:220,125:$Vl1,126:221,127:$V31,129:$Vm1},o($Vn1,[2,138]),{37:58,45:$Vg,47:$Vh,49:62,64:223,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($Vo1,[2,76],{28:224,81:[1,225]}),{69:[1,226]},o($VD,[2,60],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),{39:95,42:227,45:$VE,47:$Va,49:96,119:$Vx,120:$Vy,121:$Vz},o($Ve,[2,27],{52:155,51:228,53:$V61,55:$V71,56:$V81,57:$V91,58:$Va1,59:$Vb1,60:$Vc1,61:$Vd1,62:$Ve1}),o($Vp1,[2,43]),{53:[1,229]},{53:[2,46]},{53:[2,47],57:[1,230]},{53:[2,49],57:[1,231]},{53:[2,51]},{57:[1,232]},{53:[2,53]},{53:[2,54]},{53:[2,55]},{46:[1,233]},o($Vf1,[2,34]),{47:[1,234]},o($Vf1,[2,37]),{47:[1,235]},o($V8,[2,183],{44:$Vq1}),{37:58,45:$Vg,47:$Vh,49:62,64:238,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC,159:237},{44:$Vr1,46:[1,239]},o($Vf1,[2,197]),{37:58,45:$Vg,47:$Vh,49:62,64:241,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{47:$VF,91:$Vi,96:102,154:242},{37:58,45:$Vg,47:$Vh,49:62,64:243,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{47:[1,244]},o($V8,[2,181],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),{45:[1,245]},{118:[1,246]},o($V8,[2,229]),{47:[1,247]},{47:$Vs1,182:248},o($VI,[2,88]),o($VI,[2,90]),{92:[1,250]},o($VI,[2,92]),o([5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,130,135,136,137,138,139,140,143,144,145,146,147,148,151,155,156,162,187,188],[2,142],{141:127,95:$VJ,131:$VL,132:$VM,133:$VN,134:$VO}),o($Vk1,[2,143],{141:127,95:$VJ,133:$VN,134:$VO}),o($Vk1,[2,144],{141:127,95:$VJ,133:$VN,134:$VO}),o($V$,[2,145],{141:127}),o($V$,[2,146],{141:127}),o($V$,[2,147],{141:127}),o($Vt1,[2,148],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,145:$VX,146:$VY}),o($Vt1,[2,149],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,145:$VX,146:$VY}),o($Vt1,[2,150],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,145:$VX,146:$VY}),o($Vt1,[2,151],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,145:$VX,146:$VY}),o($Vt1,[2,152],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,145:$VX,146:$VY}),o($Vt1,[2,153],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,145:$VX,146:$VY}),{45:[1,251]},{45:[2,173]},{45:[2,174]},{45:[2,175]},o([5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,143,144,147,148,151,155,156,162,187,188],[2,156],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,145:$VX,146:$VY}),o([5,7,31,38,40,44,46,48,53,55,56,57,58,59,60,61,62,67,68,77,78,79,80,81,84,85,87,125,127,128,129,144,151,155,156,162,187,188],[2,157],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,145:$VX,146:$VY,147:$VZ,148:$V_}),{12:252,23:11,31:$V0,37:58,45:$Vg,47:$Vh,49:62,64:212,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,113:253,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{45:[1,254]},o($Vu1,[2,165],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,145:$VX,146:$VY}),o($Vu1,[2,166],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,145:$VX,146:$VY}),{46:[1,255],95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,141:127,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_},{44:$Vv1,46:[1,256]},o($V$,[2,123]),o($Vw1,[2,124],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($V$,$Vx1,{50:[1,258]}),o($V$,[2,95]),{93:[1,259]},o($V$,[2,160]),o($V$,[2,100]),{46:[1,260]},{124:261,125:$Vl1,126:221,127:$V31,129:$Vm1},{125:[1,262]},o($Vn1,[2,137]),{37:58,45:$Vg,47:$Vh,49:62,64:263,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{95:$VJ,128:[1,264],130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,141:127,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_},o($Vy1,[2,84],{29:265,87:[1,266]}),{69:[1,267]},{37:58,45:$Vg,47:$Vh,49:62,64:273,70:268,72:269,73:$Vz1,75:$VA1,76:$VB1,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($V51,[2,30]),o($Vp1,[2,42]),{39:274,47:$Va},{53:[2,48]},{53:[2,50]},{53:[2,52]},o($Vf1,[2,33],{47:[1,275],48:[1,276]}),o($Vf1,[2,35]),o($Vf1,[2,38]),{45:[1,277]},{44:$VC1,46:[1,278]},o($Vw1,[2,189],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),{12:281,23:11,31:$V0,157:[1,280]},{47:$VF,91:$Vi,96:282},o($V8,[2,176],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($Vh1,[2,179]),o($Vh1,[2,180],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($Vi1,$Vx1,{50:[1,283]}),{47:$Vs1,48:[1,286],166:284,170:285,182:287},{47:[2,204]},o($V8,[2,231]),o($V8,[2,232]),{47:[1,290],183:288,185:[1,289]},{93:[1,291]},{12:292,23:11,31:$V0,37:58,45:$Vg,47:$Vh,49:62,64:212,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,113:293,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{46:[1,294]},{44:$Vv1,46:[1,295]},{12:296,23:11,31:$V0,37:58,45:$Vg,47:$Vh,49:62,64:212,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,113:297,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($V$,[2,114]),o($V$,[2,122]),{37:58,45:$Vg,47:$Vh,49:62,64:298,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{47:$VD1,95:[1,300]},o($V$,[2,99]),o($V$,[2,131]),{125:[1,301]},o($V$,[2,136]),{95:$VJ,125:[2,140],130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,141:127,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_},{37:58,45:$Vg,47:$Vh,49:62,64:302,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($VE1,[2,71],{30:303,78:[1,304],79:[1,305],80:[1,306]}),{37:307,92:$Vj},{37:58,45:$Vg,47:$Vh,49:62,64:310,82:308,83:309,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($V41,[2,69],{71:311,44:$VF1,77:[1,313]}),o($VG1,[2,63]),{74:[1,314]},{45:[1,315]},{45:[1,316]},o($VG1,[2,68],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($Vp1,[2,58],{54:317,63:[1,318],65:[1,319]}),o($Vf1,[2,31]),{47:[1,320]},{37:58,45:$Vg,47:$Vh,49:62,64:238,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC,159:321},o($VH1,[2,187]),{37:58,45:$Vg,47:$Vh,49:62,64:322,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{45:$Vg1,158:323},o($V8,[2,186]),o($Vf1,[2,198]),{47:$VD1},{46:[1,324]},{44:[1,325],46:[2,206]},{12:326,23:11,31:$V0},o($Vw1,[2,218]),o($VI1,[2,225],{184:327,145:[1,330],177:[1,328],180:[1,329]}),o($VI1,[2,221]),o($VJ1,[2,224],{45:[1,331]}),o($VI,[2,91]),{46:[1,332]},{44:$Vv1,46:[1,333]},o($V$,[2,161]),o($V$,[2,163]),{46:[1,334]},{44:$Vv1,46:[1,335]},o($Vw1,[2,125],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($V$,[2,97]),o($V$,[2,94]),o($V$,[2,135]),o($Vn1,[2,139],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($VE1,[2,18]),{12:336,23:11,31:$V0,35:[1,337]},{12:338,23:11,31:$V0},{12:339,23:11,31:$V0},o($Vy1,[2,86],{88:340,89:[1,341]}),o($Vo1,[2,77],{44:[1,342]}),o($VK1,[2,78]),o($VK1,[2,80],{141:127,84:[1,343],85:[1,344],95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($V41,[2,62]),{37:58,45:$Vg,47:$Vh,49:62,64:273,72:345,73:$Vz1,75:$VA1,76:$VB1,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:346,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{45:[1,347]},{37:58,45:$Vg,47:$Vh,49:62,64:273,70:348,72:269,73:$Vz1,75:$VA1,76:$VB1,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{37:58,45:$Vg,47:$Vh,49:62,64:273,70:349,72:269,73:$Vz1,75:$VA1,76:$VB1,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($Vp1,[2,44]),{37:58,45:$Vg,47:$Vh,49:62,64:350,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{47:$VF,66:351,91:$Vi,96:172},o($Vf1,[2,32]),{44:$VC1,46:[1,352]},o($Vw1,[2,190],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($V8,[2,184],{44:$Vq1}),o($V8,[2,199]),o($VL1,$VM1,{171:353,182:354,172:355,173:356,47:$Vs1,176:$VN1}),{46:[2,207]},o($VI1,[2,220]),{178:[1,358]},{178:[1,359]},{117:[1,360]},{186:[1,361]},o($V$,[2,154]),o($V$,[2,155]),o($V$,[2,162]),o($V$,[2,164]),o($VE1,[2,72]),{12:362,23:11,31:$V0},o($VE1,[2,74]),o($VE1,[2,75]),o($Vy1,[2,85]),{37:363,92:$Vj},{37:58,45:$Vg,47:$Vh,49:62,64:310,83:364,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},o($VK1,[2,81]),{86:[1,365]},o($VG1,[2,64]),o($V41,[2,70],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),{37:58,45:$Vg,47:$Vh,49:62,64:273,70:366,72:269,73:$Vz1,75:$VA1,76:$VB1,91:$Vi,92:$Vj,94:57,95:$Vk,96:56,97:53,98:54,99:55,100:59,101:60,102:61,103:63,104:64,105:65,106:$Vl,107:$Vm,108:$Vn,109:$Vo,110:$Vp,111:$Vq,112:$Vr,114:$Vs,115:$Vt,116:$Vu,117:$Vv,118:$Vw,119:$Vx,120:$Vy,121:$Vz,122:$VA,132:$VB,145:$VC},{44:$VF1,46:[1,367]},{44:$VF1,46:[1,368]},o($Vp1,[2,56],{141:127,95:$VJ,130:$VK,131:$VL,132:$VM,133:$VN,134:$VO,135:$VP,136:$VQ,137:$VR,138:$VS,139:$VT,140:$VU,143:$VV,144:$VW,145:$VX,146:$VY,147:$VZ,148:$V_}),o($Vp1,[2,57],{44:$Vr1}),o($VH1,[2,188]),{44:[1,369],46:[2,205]},o($Vw1,[2,219]),o($Vw1,[2,208]),{174:370,175:371,177:[1,372],180:[1,373]},{47:[1,374]},o($VI1,[2,226]),{181:[1,375]},o($VI1,[2,228]),{46:[1,377],50:[1,376]},o($VE1,[2,73]),o($Vy1,[2,87]),o($VK1,[2,79]),o($VK1,[2,82],{84:[1,378]}),{44:$VF1,46:[1,379]},o($VG1,[2,66]),o($VG1,[2,67]),o($VL1,$VM1,{173:356,172:380,176:$VN1}),o($Vw1,[2,210]),o($Vw1,[2,211]),{178:[1,381]},{178:[1,382]},o($VL1,[2,213]),{47:[1,383]},{186:[1,384]},o($VJ1,[2,223]),o($VK1,[2,83]),o($VG1,[2,65]),o($Vw1,[2,209]),{45:[1,385]},{45:[1,386]},{45:[1,387]},{46:[1,388]},{47:$VO1,179:389},{47:$VO1,179:391},{47:[1,392]},o($VJ1,[2,222]),{44:$VP1,46:[1,393]},o($Vw1,[2,216]),{44:$VP1,46:[1,395]},{46:[1,396]},o($Vw1,[2,214]),{47:[1,397]},{181:[1,398]},o($VI1,[2,227]),o($Vw1,[2,217]),{47:[1,399]},{45:[1,400]},{47:$VO1,179:401},{44:$VP1,46:[1,402]},o($Vw1,[2,215])],
defaultActions: {19:[2,1],29:[2,201],30:[2,202],82:[2,115],83:[2,116],84:[2,117],85:[2,118],86:[2,119],87:[2,120],88:[2,121],156:[2,46],159:[2,51],161:[2,53],162:[2,54],163:[2,55],200:[2,173],201:[2,174],202:[2,175],230:[2,48],231:[2,50],232:[2,52],246:[2,204],326:[2,207]},
parseError: function parseError(str, hash) {
    if (hash.recoverable) {
        this.trace(str);
    } else {
        throw new Error(str);
    }
},
parse: function parse(input) {
    var self = this, stack = [0], tstack = [], vstack = [null], lstack = [], table = this.table, yytext = '', yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;
    var args = lstack.slice.call(arguments, 1);
    var lexer = Object.create(this.lexer);
    var sharedState = { yy: {} };
    for (var k in this.yy) {
        if (Object.prototype.hasOwnProperty.call(this.yy, k)) {
            sharedState.yy[k] = this.yy[k];
        }
    }
    lexer.setInput(input, sharedState.yy);
    sharedState.yy.lexer = lexer;
    sharedState.yy.parser = this;
    if (typeof lexer.yylloc == 'undefined') {
        lexer.yylloc = {};
    }
    var yyloc = lexer.yylloc;
    lstack.push(yyloc);
    var ranges = lexer.options && lexer.options.ranges;
    if (typeof sharedState.yy.parseError === 'function') {
        this.parseError = sharedState.yy.parseError;
    } else {
        this.parseError = Object.getPrototypeOf(this).parseError;
    }
    function popStack(n) {
        stack.length = stack.length - 2 * n;
        vstack.length = vstack.length - n;
        lstack.length = lstack.length - n;
    }
    _token_stack:
        function lex() {
            var token;
            token = lexer.lex() || EOF;
            if (typeof token !== 'number') {
                token = self.symbols_[token] || token;
            }
            return token;
        }
    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;
    while (true) {
        state = stack[stack.length - 1];
        if (this.defaultActions[state]) {
            action = this.defaultActions[state];
        } else {
            if (symbol === null || typeof symbol == 'undefined') {
                symbol = lex();
            }
            action = table[state] && table[state][symbol];
        }
                    if (typeof action === 'undefined' || !action.length || !action[0]) {
                var errStr = '';
                expected = [];
                for (p in table[state]) {
                    if (this.terminals_[p] && p > TERROR) {
                        expected.push('\'' + this.terminals_[p] + '\'');
                    }
                }
                if (lexer.showPosition) {
                    errStr = 'Parse error on line ' + (yylineno + 1) + ':\n' + lexer.showPosition() + '\nExpecting ' + expected.join(', ') + ', got \'' + (this.terminals_[symbol] || symbol) + '\'';
                } else {
                    errStr = 'Parse error on line ' + (yylineno + 1) + ': Unexpected ' + (symbol == EOF ? 'end of input' : '\'' + (this.terminals_[symbol] || symbol) + '\'');
                }
                this.parseError(errStr, {
                    text: lexer.match,
                    token: this.terminals_[symbol] || symbol,
                    line: lexer.yylineno,
                    loc: yyloc,
                    expected: expected
                });
            }
        if (action[0] instanceof Array && action.length > 1) {
            throw new Error('Parse Error: multiple actions possible at state: ' + state + ', token: ' + symbol);
        }
        switch (action[0]) {
        case 1:
            stack.push(symbol);
            vstack.push(lexer.yytext);
            lstack.push(lexer.yylloc);
            stack.push(action[1]);
            symbol = null;
            if (!preErrorSymbol) {
                yyleng = lexer.yyleng;
                yytext = lexer.yytext;
                yylineno = lexer.yylineno;
                yyloc = lexer.yylloc;
                if (recovering > 0) {
                    recovering--;
                }
            } else {
                symbol = preErrorSymbol;
                preErrorSymbol = null;
            }
            break;
        case 2:
            len = this.productions_[action[1]][1];
            yyval.$ = vstack[vstack.length - len];
            yyval._$ = {
                first_line: lstack[lstack.length - (len || 1)].first_line,
                last_line: lstack[lstack.length - 1].last_line,
                first_column: lstack[lstack.length - (len || 1)].first_column,
                last_column: lstack[lstack.length - 1].last_column
            };
            if (ranges) {
                yyval._$.range = [
                    lstack[lstack.length - (len || 1)].range[0],
                    lstack[lstack.length - 1].range[1]
                ];
            }
            r = this.performAction.apply(yyval, [
                yytext,
                yyleng,
                yylineno,
                sharedState.yy,
                action[1],
                vstack,
                lstack
            ].concat(args));
            if (typeof r !== 'undefined') {
                return r;
            }
            if (len) {
                stack = stack.slice(0, -1 * len * 2);
                vstack = vstack.slice(0, -1 * len);
                lstack = lstack.slice(0, -1 * len);
            }
            stack.push(this.productions_[action[1]][0]);
            vstack.push(yyval.$);
            lstack.push(yyval._$);
            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];
            stack.push(newState);
            break;
        case 3:
            return true;
        }
    }
    return true;
}};
/* generated by jison-lex 0.3.4 */
var lexer = (function(){
var lexer = ({

EOF:1,

parseError:function parseError(str, hash) {
        if (this.yy.parser) {
            this.yy.parser.parseError(str, hash);
        } else {
            throw new Error(str);
        }
    },

// resets the lexer, sets new input
setInput:function (input, yy) {
        this.yy = yy || this.yy || {};
        this._input = input;
        this._more = this._backtrack = this.done = false;
        this.yylineno = this.yyleng = 0;
        this.yytext = this.matched = this.match = '';
        this.conditionStack = ['INITIAL'];
        this.yylloc = {
            first_line: 1,
            first_column: 0,
            last_line: 1,
            last_column: 0
        };
        if (this.options.ranges) {
            this.yylloc.range = [0,0];
        }
        this.offset = 0;
        return this;
    },

// consumes and returns one char from the input
input:function () {
        var ch = this._input[0];
        this.yytext += ch;
        this.yyleng++;
        this.offset++;
        this.match += ch;
        this.matched += ch;
        var lines = ch.match(/(?:\r\n?|\n).*/g);
        if (lines) {
            this.yylineno++;
            this.yylloc.last_line++;
        } else {
            this.yylloc.last_column++;
        }
        if (this.options.ranges) {
            this.yylloc.range[1]++;
        }

        this._input = this._input.slice(1);
        return ch;
    },

// unshifts one char (or a string) into the input
unput:function (ch) {
        var len = ch.length;
        var lines = ch.split(/(?:\r\n?|\n)/g);

        this._input = ch + this._input;
        this.yytext = this.yytext.substr(0, this.yytext.length - len);
        //this.yyleng -= len;
        this.offset -= len;
        var oldLines = this.match.split(/(?:\r\n?|\n)/g);
        this.match = this.match.substr(0, this.match.length - 1);
        this.matched = this.matched.substr(0, this.matched.length - 1);

        if (lines.length - 1) {
            this.yylineno -= lines.length - 1;
        }
        var r = this.yylloc.range;

        this.yylloc = {
            first_line: this.yylloc.first_line,
            last_line: this.yylineno + 1,
            first_column: this.yylloc.first_column,
            last_column: lines ?
                (lines.length === oldLines.length ? this.yylloc.first_column : 0)
                 + oldLines[oldLines.length - lines.length].length - lines[0].length :
              this.yylloc.first_column - len
        };

        if (this.options.ranges) {
            this.yylloc.range = [r[0], r[0] + this.yyleng - len];
        }
        this.yyleng = this.yytext.length;
        return this;
    },

// When called from action, caches matched text and appends it on next action
more:function () {
        this._more = true;
        return this;
    },

// When called from action, signals the lexer that this rule fails to match the input, so the next matching rule (regex) should be tested instead.
reject:function () {
        if (this.options.backtrack_lexer) {
            this._backtrack = true;
        } else {
            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n' + this.showPosition(), {
                text: "",
                token: null,
                line: this.yylineno
            });

        }
        return this;
    },

// retain first n characters of the match
less:function (n) {
        this.unput(this.match.slice(n));
    },

// displays already matched input, i.e. for error messages
pastInput:function () {
        var past = this.matched.substr(0, this.matched.length - this.match.length);
        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\n/g, "");
    },

// displays upcoming input, i.e. for error messages
upcomingInput:function () {
        var next = this.match;
        if (next.length < 20) {
            next += this._input.substr(0, 20-next.length);
        }
        return (next.substr(0,20) + (next.length > 20 ? '...' : '')).replace(/\n/g, "");
    },

// displays the character position where the lexing error occurred, i.e. for error messages
showPosition:function () {
        var pre = this.pastInput();
        var c = new Array(pre.length + 1).join("-");
        return pre + this.upcomingInput() + "\n" + c + "^";
    },

// test the lexed token: return FALSE when not a match, otherwise return token
test_match:function (match, indexed_rule) {
        var token,
            lines,
            backup;

        if (this.options.backtrack_lexer) {
            // save context
            backup = {
                yylineno: this.yylineno,
                yylloc: {
                    first_line: this.yylloc.first_line,
                    last_line: this.last_line,
                    first_column: this.yylloc.first_column,
                    last_column: this.yylloc.last_column
                },
                yytext: this.yytext,
                match: this.match,
                matches: this.matches,
                matched: this.matched,
                yyleng: this.yyleng,
                offset: this.offset,
                _more: this._more,
                _input: this._input,
                yy: this.yy,
                conditionStack: this.conditionStack.slice(0),
                done: this.done
            };
            if (this.options.ranges) {
                backup.yylloc.range = this.yylloc.range.slice(0);
            }
        }

        lines = match[0].match(/(?:\r\n?|\n).*/g);
        if (lines) {
            this.yylineno += lines.length;
        }
        this.yylloc = {
            first_line: this.yylloc.last_line,
            last_line: this.yylineno + 1,
            first_column: this.yylloc.last_column,
            last_column: lines ?
                         lines[lines.length - 1].length - lines[lines.length - 1].match(/\r?\n?/)[0].length :
                         this.yylloc.last_column + match[0].length
        };
        this.yytext += match[0];
        this.match += match[0];
        this.matches = match;
        this.yyleng = this.yytext.length;
        if (this.options.ranges) {
            this.yylloc.range = [this.offset, this.offset += this.yyleng];
        }
        this._more = false;
        this._backtrack = false;
        this._input = this._input.slice(match[0].length);
        this.matched += match[0];
        token = this.performAction.call(this, this.yy, this, indexed_rule, this.conditionStack[this.conditionStack.length - 1]);
        if (this.done && this._input) {
            this.done = false;
        }
        if (token) {
            return token;
        } else if (this._backtrack) {
            // recover context
            for (var k in backup) {
                this[k] = backup[k];
            }
            return false; // rule action called reject() implying the next rule should be tested instead.
        }
        return false;
    },

// return next match in input
next:function () {
        if (this.done) {
            return this.EOF;
        }
        if (!this._input) {
            this.done = true;
        }

        var token,
            match,
            tempMatch,
            index;
        if (!this._more) {
            this.yytext = '';
            this.match = '';
        }
        var rules = this._currentRules();
        for (var i = 0; i < rules.length; i++) {
            tempMatch = this._input.match(this.rules[rules[i]]);
            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {
                match = tempMatch;
                index = i;
                if (this.options.backtrack_lexer) {
                    token = this.test_match(tempMatch, rules[i]);
                    if (token !== false) {
                        return token;
                    } else if (this._backtrack) {
                        match = false;
                        continue; // rule action called reject() implying a rule MISmatch.
                    } else {
                        // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)
                        return false;
                    }
                } else if (!this.options.flex) {
                    break;
                }
            }
        }
        if (match) {
            token = this.test_match(match, rules[index]);
            if (token !== false) {
                return token;
            }
            // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)
            return false;
        }
        if (this._input === "") {
            return this.EOF;
        } else {
            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. Unrecognized text.\n' + this.showPosition(), {
                text: "",
                token: null,
                line: this.yylineno
            });
        }
    },

// return next match that has a token
lex:function lex() {
        var r = this.next();
        if (r) {
            return r;
        } else {
            return this.lex();
        }
    },

// activates a new lexer condition state (pushes the new lexer condition state onto the condition stack)
begin:function begin(condition) {
        this.conditionStack.push(condition);
    },

// pop the previously active lexer condition state off the condition stack
popState:function popState() {
        var n = this.conditionStack.length - 1;
        if (n > 0) {
            return this.conditionStack.pop();
        } else {
            return this.conditionStack[0];
        }
    },

// produce the lexer rule set which is active for the currently active lexer condition state
_currentRules:function _currentRules() {
        if (this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1]) {
            return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules;
        } else {
            return this.conditions["INITIAL"].rules;
        }
    },

// return the currently active lexer condition state; when an index argument is provided it produces the N-th previous condition state, if available
topState:function topState(n) {
        n = this.conditionStack.length - 1 - Math.abs(n || 0);
        if (n >= 0) {
            return this.conditionStack[n];
        } else {
            return "INITIAL";
        }
    },

// alias for begin(condition)
pushState:function pushState(condition) {
        this.begin(condition);
    },

// return the number of states currently on the stack
stateStackSize:function stateStackSize() {
        return this.conditionStack.length;
    },
options: {"case-insensitive":true},
performAction: function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {
var YYSTATE=YY_START;
switch($avoiding_name_collisions) {
case 0:/* skip whitespace */
break;
case 1:return 35
break;
case 2:return 188
break;
case 3:return 143
break;
case 4:return 61
break;
case 5:return 150
break;
case 6:return 48
break;
case 7:return 84
break;
case 8:return 110
break;
case 9:return 147
break;
case 10:return 148
break;
case 11:return 69
break;
case 12:return "CASE"
break;
case 13:return 85
break;
case 14:return "CONSTRAINT"
break;
case 15:return "COUNT"
break;
case 16:return 162
break;
case 17:return "CROSS"
break;
case 18:return 76
break;
case 19:return 155
break;
case 20:return 84
break;
case 21:return 32
break;
case 22:return 187
break;
case 23:return 125
break;
case 24:return 129
break;
case 25:return 79
break;
case 26:return 118
break;
case 27:return 9
break;
case 28:return 115
break;
case 29:return 111
break;
case 30:return 180
break;
case 31:return 40
break;
case 32:return 68
break;
case 33:return 73
break;
case 34:return 77
break;
case 35:return 169
break;
case 36:return 146
break;
case 37:return 55
break;
case 38:return 156
break;
case 39:return 80
break;
case 40:return 38
break;
case 41:return 53
break;
case 42:return 178
break;
case 43:return 112
break;
case 44:return 56
break;
case 45:return 130
break;
case 46:return 87
break;
case 47:return "MAX"
break;
case 48:return "MIN"
break;
case 49:return 86
break;
case 50:return 145
break;
case 51:return 117
break;
case 52:return 63
break;
case 53:return 89
break;
case 54:return 144
break;
case 55:return 81
break;
case 56:return 57
break;
case 57:return 11
break;
case 58:return 177
break;
case 59:return 10
break;
case 60:return 181
break;
case 61:return 189
break;
case 62:return 58
break;
case 63:return 75
break;
case 64:return 31
break;
case 65:return 60
break;
case 66:return 152
break;
case 67:return 74
break;
case 68:return 149
break;
case 69:return "SUM"
break;
case 70:return 164
break;
case 71:return 128
break;
case 72:return 190
break;
case 73:return 36
break;
case 74:return 114
break;
case 75:return 78
break;
case 76:return 151
break;
case 77:return 65
break;
case 78:return 157
break;
case 79:return 127
break;
case 80:return 67
break;
case 81:return 92
break;
case 82:return 131
break;
case 83:return 132
break;
case 84:return 95
break;
case 85:return 133
break;
case 86:return 134
break;
case 87:return 136
break;
case 88:return 135
break;
case 89:return 138
break;
case 90:return 140
break;
case 91:return 137
break;
case 92:return 139
break;
case 93:return 140
break;
case 94:return 45
break;
case 95:return 46
break;
case 96:return 91
break;
case 97:return 93
break;
case 98:return 50
break;
case 99:return 44
break;
case 100:return 120
break;
case 101:return 7
break;
case 102:return 119
break;
case 103:return 121
break;
case 104:return 47
break;
case 105:return 116
break;
case 106:return 116
break;
case 107:return 5
break;
case 108:return 'INVALID'
break;
}
},
rules: [/^(?:\s+)/i,/^(?:ALL\b)/i,/^(?:ALTER\b)/i,/^(?:AND\b)/i,/^(?:ANTI\b)/i,/^(?:ANY\b)/i,/^(?:AS\b)/i,/^(?:ASC\b)/i,/^(?:AVG\b)/i,/^(?:BETWEEN\b)/i,/^(?:NOT BETWEEN\b)/i,/^(?:BY\b)/i,/^(?:CASE\b)/i,/^(?:COLLATE\b)/i,/^(?:CONSTRAINT\b)/i,/^(?:COUNT\b)/i,/^(?:CREATE\b)/i,/^(?:CROSS\b)/i,/^(?:CUBE\b)/i,/^(?:DELETE\b)/i,/^(?:DESC\b)/i,/^(?:DISTINCT\b)/i,/^(?:DROP\b)/i,/^(?:END\b)/i,/^(?:ELSE\b)/i,/^(?:EXCEPT\b)/i,/^(?:EXISTS\b)/i,/^(?:EXPLAIN\b)/i,/^(?:FALSE\b)/i,/^(?:FIRST\b)/i,/^(?:FOREIGN\b)/i,/^(?:FROM\b)/i,/^(?:GROUP\b)/i,/^(?:GROUPING\b)/i,/^(?:HAVING\b)/i,/^(?:IF\b)/i,/^(?:IN\b)/i,/^(?:INNER\b)/i,/^(?:INSERT\b)/i,/^(?:INTERSECT\b)/i,/^(?:INTO\b)/i,/^(?:JOIN\b)/i,/^(?:KEY\b)/i,/^(?:LAST\b)/i,/^(?:LEFT\b)/i,/^(?:LIKE\b)/i,/^(?:LIMIT\b)/i,/^(?:MAX\b)/i,/^(?:MIN\b)/i,/^(?:NOCASE\b)/i,/^(?:NOT\b)/i,/^(?:NULL\b)/i,/^(?:ON\b)/i,/^(?:OFFSET\b)/i,/^(?:OR\b)/i,/^(?:ORDER\b)/i,/^(?:OUTER\b)/i,/^(?:PLAN\b)/i,/^(?:PRIMARY\b)/i,/^(?:QUERY\b)/i,/^(?:REFERENCES\b)/i,/^(?:RENAME\b)/i,/^(?:RIGHT\b)/i,/^(?:ROLLUP\b)/i,/^(?:SELECT\b)/i,/^(?:SEMI\b)/i,/^(?:SET\b)/i,/^(?:SETS\b)/i,/^(?:SOME\b)/i,/^(?:SUM\b)/i,/^(?:TABLE\b)/i,/^(?:THEN\b)/i,/^(?:TO\b)/i,/^(?:TOP\b)/i,/^(?:TRUE\b)/i,/^(?:UNION\b)/i,/^(?:UPDATE\b)/i,/^(?:USING\b)/i,/^(?:VALUES\b)/i,/^(?:WHEN\b)/i,/^(?:WHERE\b)/i,/^(?:(\d*[.])?\d+)/i,/^(?:\+)/i,/^(?:-)/i,/^(?:\*)/i,/^(?:\/)/i,/^(?:%)/i,/^(?:>=)/i,/^(?:>)/i,/^(?:<=)/i,/^(?:<>)/i,/^(?:<)/i,/^(?:=)/i,/^(?:!=)/i,/^(?:\()/i,/^(?:\))/i,/^(?:\[)/i,/^(?:\])/i,/^(?:\.)/i,/^(?:,)/i,/^(?::)/i,/^(?:;)/i,/^(?:\$)/i,/^(?:\?)/i,/^(?:[a-zA-Z_][a-zA-Z_0-9]*)/i,/^(?:['](\\.|[^'])*['])/i,/^(?:["](\\.|[^"])*["])/i,/^(?:$)/i,/^(?:.)/i],
conditions: {"INITIAL":{"rules":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108],"inclusive":true}}
});
return lexer;
})();
parser.lexer = lexer;
function Parser () {
  this.yy = {};
}
Parser.prototype = parser;parser.Parser = Parser;
return new Parser;
})();


if (typeof require !== 'undefined' && typeof exports !== 'undefined') {
exports.parser = parser;
exports.Parser = parser.Parser;
exports.parse = function () { return parser.parse.apply(parser, arguments); };
exports.main = function commonjsMain(args) {
    if (!args[1]) {
        console.log('Usage: '+args[0]+' FILE');
        process.exit(1);
    }
    var source = require('fs').readFileSync(require('path').normalize(args[1]), "utf8");
    return exports.parser.parse(source);
};
if (typeof module !== 'undefined' && require.main === module) {
  exports.main(process.argv.slice(1));
}
}

/*
//
// Utilities for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

var utils = {};

// Fast hash function
var hash = utils.hash = function hash(str){
    var h = 0;
    if (str.length == 0) return h;
    for (var i = 0; i < str.length; i++) {
        h = ((h<<5)-h)+str.charCodeAt(i);
        h = h & h; 
   	}
    return h;
};


// Union arrays
var arrayUnion = utils.arrayUnion = function arrayUnion (a,b) {
    var r = b.slice(0);
    a.forEach(function(i) { if (r.indexOf(i) < 0) r.push(i); });
    return r;
};

// Array Difference
var arrayDiff = utils.arrayDiff  = function arrayDiff (a,b) {
    return a.filter(function(i) {return b.indexOf(i) < 0;});
};

// Arrays deep union (with records)
var arrayUnionDeep = utils.arrayUnionDeep = function arrayUnionDeep (a,b) {
    var r = b.slice(0);
    a.forEach(function(ai) {
        var found = false;
        
        r.forEach(function(ri){
            found = found || equalDeep(ai, ri, true);
        });

        if(!found) {
            r.push(ai); 
        }
    });
    return r;
};

// Arrays deep union (with records)
var arrayExceptDeep = utils.arrayExceptDeep = function arrayExceptDeep(a,b) {
    var r = [];
    a.forEach(function(ai) {
        var found = false;
        
        b.forEach(function(bi){
            found = found || equalDeep(ai, bi, true);
        });

        if(!found) {
            r.push(ai); 
        }
    });
    return r;
};

// Arrays deep intersect (with records)
var arrayIntersectDeep = utils.arrayInterseptDeep  = function(a,b) {
    var r = [];
    a.forEach(function(ai) {
        var found = false;
        
        b.forEach(function(bi){
            found = found || equalDeep(ai, bi, true);
        });

        if(found) {
            r.push(ai); 
        }
    });
    return r;
};

// Deep clone obects
var cloneDeep = utils.cloneDeep = function cloneDeep(obj) {
    if(obj == null || typeof(obj) != 'object')
        return obj;

    var temp = obj.constructor(); // changed

    for(var key in obj) {
        if(obj.hasOwnProperty(key)) {
            temp[key] = cloneDeep(obj[key]);
        }
    }
    return temp;
}

// Check equality of objects
var equalDeep = utils.equalDeep = function equalDeep (x, y, deep) {
    if (deep) {
        if (x == y) return true;

        var p;
        for (p in y) {
            if (typeof (x[p]) == 'undefined') { return false; }
        }

        for (p in y) {
            if (y[p]) {
                switch (typeof (y[p])) {
                    case 'object':
                        if (!equalDeep(y[p],x[p])) { return false; } break;
                    case 'function':
                        if (typeof (x[p]) == 'undefined' ||
                  (p != 'equals' && y[p].toString() != x[p].toString()))
                            return false;
                        break;
                    default:
                        if (y[p] != x[p]) { return false; }
                }
            } else {
                if (x[p])
                    return false;
            }
        }

        for (p in x) {
            if (typeof (y[p]) == 'undefined') { return false; }
        }

        return true;
    }
    return x == y;
};

// Extend object
var extend = utils.extend = function extend (a,b){
    if(typeof a == 'undefined') a = {};
    for(key in b) {
        if(b.hasOwnProperty(key)) {
            a[key] = b[key]
        }
    }
    return a;
};;

// Flat array by first row
var flatArray = utils.flatArray = function flatArray(a) {
    if(!a || a.length == 0) return [];
    var key = Object.keys(a[0])[0];
    if(typeof key == 'undefined') return [];
    return a.map(function(ai) {return ai[key]});
};

var arrayOfArrays = utils.arrayOfArrays = function flatArray(a) {
    return a.map(function(aa){
        var ar = [];
        for(var key in aa) ar[key] = aa[key];
        return ar;
    });
};



/*
//
// Database class for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// Main database variable
var alasql = function(sql, params, cb) {
	return alasql.currentDatabase.exec(sql, params, cb);
};

// Initial parameters
alasql.parser = parser;
alasql.parse = parser.parse.bind(parser); // Shortcut

// Useful library
alasql.utils = utils;

alasql.databases = {};

// Create default database
alasql.currentDatabase = new Database();
alasql.tables = alasql.currentDatabase.tables;

alasql.MAXSQLCACHESIZE = 10000;

// Main Database class
function Database(databaseid) {
	var self = this;
	if(self == alasql) self = new Database(databaseid); // to call without new
	if(!databaseid) {
		databaseid = +Date.now()+""; // Random name
	}
	self.databaseid = databaseid;
	alasql.databases[databaseid] = self;
	self.tables = {};   // Tables
	self.sqlcache = {}; // Cache for compiled SQL statements
	self.sqlcachesize = 0;
	return self;
};

// Start database
alasql.Database = Database;

// Compiler
alasql.compile = function(sql) {
	return this.currentDatabase.compile(sql);
}

// Default methods to exec SQL statements
alasql.run = alasql.exec = function (sql, params, cb) {
	return this.currentDatabase.exec(sql, params, cb);
};

// Promised version of exec
alasql.aexec = function (sql, params) {
	return this.currentDatabase.aexec(sql, params);
};


// MSSQL-Like aliases
alasql.query = function (sql, params, cb) {
	return this.currentDatabase.query(sql, params.cb);
}
alasql.queryArray = function (sql, params, cb) {
	return this.currentDatabase.queryArray(sql, params.cb);
}
alasql.querySingle = function (sql, params, cb) {
	return this.currentDatabase.querySingle(sql, params, cb);
}
alasql.queryValue = function (sql, params, cb) {
	return this.currentDatabase.queryValue(sql, params, cb);
}

alasql.queryArray = function (sql, params, cb) {
	return this.currentDatabase.queryArray(sql, params, cb);
}
alasql.queryArrayOfArrays = function (sql, params, cb) {
	return this.currentDatabase.queryArrayOfArrays(sql, params, cb);
}

alasql.indexColumns = function(tableid) {
	this.currentDatabase.indexColumns(tableid);
}

// Main SQL function
Database.prototype.exec = function(sql, params, cb) {
	// Compile
	var statement = this.compile(sql);
	// Run
	var data = statement(params, cb);
	return data;
};

// Async version of exec
Database.prototype.aexec = function(sql, params) {
	var self = this;
	return new Promise(function(resolve, reject){
		self.exec(sql,params,resolve);
	});
};


// Aliases like MS SQL
Database.prototype.query = Database.prototype.exec;
Database.prototype.run = Database.prototype.exec;
Database.prototype.queryArray = function(sql, params, cb) {
	return flatArray(this.exec(sql, params, cb));
}

Database.prototype.queryArrayOfArrays = function(sql, params, cb) {
	return arrayOfArrays(this.exec(sql, params, cb));
}

Database.prototype.querySingle = function(sql, params, cb) {
	return this.exec(sql, params, cb)[0];
}
Database.prototype.queryValue = function(sql, params, cb) {
	var res = this.querySingle(sql, params, cb);
	return res[Object.keys(res)[0]];
}


// Compile statements
Database.prototype.compile = function(sql) {
	var hh = hash(sql);

	// Check cache with hash of SQL statement
	var statement = this.sqlcache[hh];
	if(!statement) {
		// If not fount, then compile it
		var ast = alasql.parse(sql);
		// Save to cache
		statement = this.sqlcache[hh]= ast.compile(this);

		// Memory leak prevention 
		this.sqlcachesize++;
		if(this.sqlcachesize > alasql.MAXSQLCACHESIZE) {
			this.sqlcache = {};
			this.sqlcachesize = 0;
		}
	};
	return statement;
}

// SQL.js compatibility method
Database.prototype.prepare = Database.prototype.compile;

// Added for compatibility with WebSQL
Database.prototype.transaction = function(cb) {
	var tx = new alasql.Transaction(this.databaseid);
	var res = cb(tx);
	return res;
};

// Index columns in table utility
Database.prototype.indexColumns = function(tableid) {
	var table = this.tables[tableid];
	table.xcolumns = {};
	table.columns.forEach(function(col){
		table.xcolumns[col.columnid] = col;
	});	
}


/*
//
// Transactio class for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// Transaction class (for WebSQL compatibility)
function Transaction(databaseid) {
	this.transactionid = Date.now();
	this.databaseid = databaseid;
	this.commited = false; 
	this.bank = cloneDeep(alasql.databases[databaseid].tables);
	return this;
};

// Main class 
alasql.Transaction = Transaction;

// Commit
Transaction.prototype.commit = function() {
	this.commited = true;
	delete this.bank;
};

// Rollback
Transaction.prototype.rollback = function() {
	if(!this.commited) {
		alasql.databases[this.databaseid].tables = this.bank;
		delete this.bank;
	} else {
		throw new Error('Transaction already commited');
	}
};

// Transactions stub
Transaction.prototype.exec = Transaction.prototype.executeSQL = function(sql, params, cb) {
	return alasql.databases[this.databaseid].exec(sql);
};

// MSSQL-Like aliases
Transaction.prototype.query = function (sql, params, cb) {
	return alasql.databases[this.databaseid].query(sql, params.cb);
}
Transaction.prototype.querySingle = function (sql, params, cb) {
	return alasql.databases[this.databaseid].querySingle(sql, params, cb);
}
Transaction.prototype.queryValue = function (sql, params, cb) {
	return alasql.databases[this.databaseid].queryValue(sql, params, cb);
}
Transaction.prototype.queryArray = function (sql, params, cb) {
	return alasql.databases[this.databaseid].queryArray(sql, params, cb);
}
Transaction.prototype.queryArrayOfArrays = function (sql, params, cb) {
	return alasql.databases[this.databaseid].queryArrayOfArrays(sql, params, cb);
}


/*
//
// Persistence Store for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// Store to Storage
alasql.store = function(databaseid, transactionid) {
	var obj = {
		tables: alasql.databases[databaseid].tables
	};
	var key = databaseid;
	if(transactionid) key += "."+transactionid;
	localStorage[key] = JSON.stringify(obj);
};

// Restore from localStorage
alasql.restore = function(databaseid, transactionid) {
	var key = databaseid;
	if(transactionid) key += "."+transactionid;

	var res = localStorage[key];
	if(res) {
		var obj = JSON.parse(localStorage[key]);
		var db = new alasql.Database(databaseid);
		db.databaseid = databaseid;
		db.tables = obj.tables;
		return db;
	} else {
		return null;
	}

};

// Clear all database records with transactions
alasql.wipe = function (databaseid, transactionid) {
	var key = databaseid;
	if(transactionid) {
		key += "."+transactionid;
		localStorage.removeItem(key);
	} else {
		for(var key in localStorage) {
			if(key.substr(0,databaseid.length+1) == databaseid+".") {
				localStorage.removeItem(key);
			};
		};
		localStorage.removeItem(databaseid);
	}
};

/*
//
// Parser helper for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

var yy = parser.yy = {};

// Utility
yy.extend = extend;


/*
//
// Statements class for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// Statements container
yy.Statements = function(params) { return yy.extend(this, params); };

yy.Statements.prototype.toString = function () {
	return this.statements.map(function(st){return st.toString()}).join(';');
};

// Compile array of statements into single statement
yy.Statements.prototype.compile = function(db) {
	var statements = this.statements.map(function(st){return st.compile(db)});
	if(statements.length == 1) {
		return statements[0];	
	} else {
		return function(params, cb){
			var res = statements.map(function(st){ return st(params); });
			if(cb) cb(res);
			return res;
		}
	}
};


// Main query procedure
function queryfn(query,oldscope) {

//	console.log(query);

	// Run all subqueries before main statement
	if(query.queriesfn) {
		query.queriesdata = query.queriesfn.map(function(q){return flatArray(q(query.params))});
//		console.log(query.queriesdata[0]);
	}

	var scope;
	if(!oldscope) scope = {};
	else scope = cloneDeep(oldscope);
	query.scope = scope;

	// First - refresh data sources
	query.sources.forEach(function(source){
//		source.data = query.database.tables[source.tableid].data;
		source.data = source.datafn(query.params); 

//
// Ugly hack to use in query.wherefn and source.srcwherefns functions
// constructions like this.queriesdata['test'].
// I can elimite it with source.srcwherefn.bind(this)()
// but it may be slow.
// 
		source.queriesdata = query.queriesdata;  
	});

	// Preindexation of data sources
//	if(!oldscope) {
		preIndex(query);
//	}

	// Prepare variables
	query.data = [];
	query.xgroups = {};
	query.groups = [];

	// Level of Joins
	var h = 0;

	// Start walking over data
	doJoin(query, scope, h);

	// If groupping, then filter groups with HAVING function
	if(query.groupfn) {
		if(query.havingfn) query.groups = query.groups.filter(query.havingfn)
		query.data = query.groups;
	};

	// Remove distinct values	
	doDistinct(query);	

	// Reduce to limit and offset
	doLimit(query);

	// UNION / UNION ALL
	if(query.unionallfn) {
		query.data = query.data.concat(query.unionallfn(query.params));
	} else if(query.unionfn) {
		query.data = arrayUnionDeep(query.data, query.unionfn(query.params));
	} else if(query.exceptfn) {
		query.data = arrayExceptDeep(query.data, query.exceptfn(query.params));
	} else if(query.intersectfn) {
		query.data = arrayIntersectDeep(query.data, query.intersectfn(query.params));
	};

	// Ordering
	if(query.orderfn) query.data = query.data.sort(query.orderfn);

	// That's all
	return query.data;
};

// Limiting
function doLimit (query) {
//	console.log(query.limit, query.offset)
	if(query.limit) {
		var offset = 0;
		if(query.offset) offset = ((query.offset|0)-1)||0;
		var limit = (query.limit|0) + offset;
		query.data = query.data.slice(offset,limit);
	}
}

// Distinct
function doDistinct (query) {
	if(query.distinct) {
		var uniq = {};
		// TODO: Speedup, because Object.keys is slow
		for(var i=0,ilen=query.data.length;i<ilen;i++) {
			var uix = Object.keys(query.data[i]).map(function(k){return query.data[i][k]}).join('`');
			uniq[uix] = query.data[i];
		};
		query.data = [];
		for(var key in uniq) query.data.push(uniq[key]);
	}
};


// Optimization: preliminary indexation of joins
preIndex = function(query) {
//	console.log(query);
	// Loop over all sources
	for(var k=0, klen = query.sources.length;k<klen;k++) {
		var source = query.sources[k];
		// If there is indexation rule
//console.log('preIndex', source);

		if(source.optimization == 'ix' && source.onleftfn && source.onrightfn) {
			// If there is no table.indices - create it
			if(!query.database.tables[source.tableid].indices) query.database.tables[source.tableid].indices = {};
				// Check if index already exists
			var ixx = query.database.tables[source.tableid].indices[hash(source.onrightfns+'`'+source.srcwherefns)];
			if( !query.database.tables[source.tableid].dirty && ixx) {
				source.ix = ixx; 
			} else {
				source.ix = {};
				// Walking over source data
				var scope = {};
				for(var i=0, ilen=source.data.length; i<ilen; i++) {
					// Prepare scope for indexation
					scope[source.alias || source.tableid] = source.data[i];

					// Check if it apply to where function 
					if(source.srcwherefn(scope, query.params, alasql)) {
						// Create index entry for each address
						var addr = source.onrightfn(scope, query.params, alasql);
						var group = source.ix [addr]; 
						if(!group) {
							group = source.ix [addr] = []; 
						}
						group.push(source.data[i]);
					}
				}
				// Save index to original table				
				query.database.tables[source.tableid].indices[hash(source.onrightfns+'`'+source.srcwherefns)] = source.ix;
			}
			// Optimization for WHERE column = expression
		} else if (source.wxleftfns) {
			// Check if index exists
			var ixx = query.database.tables[source.tableid].indices[hash(source.wxleftfns+'`')];
			if( !query.database.tables[source.tableid].dirty && ixx) {
				// Use old index if exists
				source.ix = ixx;
				// Reduce data (apply filter)
				source.data = source.ix[source.wxrightfn(null, query.params, alasql)]; 
			} else {
				// Create new index
				source.ix = {};
				// Prepare scope
				var scope = {};
				// Walking on each source line
				for(var i=0, ilen=source.data.length; i<ilen; i++) {
					scope[source.alias || source.tableid] = source.data[i];
					// Create index entry
					var addr = source.wxleftfn(scope, query.params, alasql);
					var group = source.ix [addr]; 
					if(!group) {
						group = source.ix [addr] = []; 
					}
					group.push(source.data[i]);
				}
//					query.database.tables[source.tableid].indices[hash(source.wxleftfns+'`'+source.onwherefns)] = source.ix;
				query.database.tables[source.tableid].indices[hash(source.wxleftfns+'`')] = source.ix;
			}
			// Apply where filter to reduces rows
			if(source.srcwherefns) {
				if(source.data) {
					var scope = {};
					source.data = source.data.filter(function(r) {
						scope[source.alias] = r;
						return source.srcwherefn(scope, query.params, alasql);
					});
				} else {
					source.data = [];
				}
			}		

		// If there is no any optimization than apply srcwhere filter
		} else if(source.srcwherefns) {
			if(source.data) {
				var scope = {};
				source.data = source.data.filter(function(r) {
					scope[source.alias] = r;
					return source.srcwherefn(scope, query.params, alasql);
				});
			} else {
				source.data = [];
			};
		}			
		// Change this to another place (this is a wrong)
		if(query.database.tables[source.tableid]) {
			//query.database.tables[source.tableid].dirty = false;
		} else {
			// this is a subquery?
		}
	}
}



//
// Join all lines over sources 
//

function doJoin (query, scope, h) {
//	console.log(query.sources.length);
	// Check, if this is a last join?
	if(h>=query.sources.length) {
//console.log(query.wherefns);
		// Then apply where and select
		if(query.wherefn(scope,query.params, alasql)) {
			var res = query.selectfn(scope, query.params, alasql);
//			console.log("last",scope);
			// If there is a GROUP BY then pipe to groupping function
			if(query.groupfn) {
				query.groupfn(res, query.params, alasql)
			} else {
				query.data.push(res);
			}	
		}
	} else {

// STEP 1

		var source = query.sources[h];
		var nextsource = query.sources[h+1];

//		if(source.joinmode == "LEFT" || source.joinmode == "INNER" || source.joinmode == "RIGHT"
//			|| source.joinmode == "OUTER" || source.joinmode == "SEMI") {
		if(source.joinmode != "ANTI") {

			// if(nextsource && nextsource.joinmode == "RIGHT") {
			// 	if(!nextsource.rightdata) {
			// 		console.log("ok");
			// 		nextsource.rightdata = new Array(nextsource.data.length);
			// 		console.log(nextsource.data.length, nextsource.rightdata);
			// 	}
			// }

			var tableid = source.alias || source.tableid; 
			var pass = false; // For LEFT JOIN
			var data = source.data;


			// Reduce data for looping if there is optimization hint
			if(source.joinmode != "RIGHT" && source.joinmode != "OUTER" && source.joinmode != "ANTI" && source.optimization == 'ix') {
				data = source.ix[ source.onleftfn(scope, query.params, alasql) ] || [];
			}

			// Main cycle
			for(var i=0, ilen=data.length; i<ilen; i++) {
				scope[tableid] = data[i];
				// Reduce with ON and USING clause
				if(!source.onleftfn || (source.onleftfn(scope, query.params, alasql) == source.onrightfn(scope, query.params, alasql))) {
					// For all non-standard JOINs like a-b=0
					if(source.onmiddlefn(scope, query.params, alasql)) {
						// Recursively call new join
//						if(source.joinmode == "LEFT" || source.joinmode == "INNER" || source.joinmode == "OUTER" || source.joinmode == "RIGHT" ) {
						if(source.joinmode != "SEMI") { 
//							console.log(scope);
							doJoin(query, scope, h+1);
						}

						// if(source.data[i].f = 200) debugger;

//						if(source.joinmode == "RIGHT" || source.joinmode == "ANTI" || source.joinmode == "OUTER") {
						if(source.joinmode != "LEFT" && source.joinmode != "INNER") {
							data[i]._rightjoin = true;
						}

						// for LEFT JOIN
						pass = true;
					}
				}
			};


			// Additional join for LEFT JOINS
			if((source.joinmode == 'LEFT' || source.joinmode == 'OUTER' || source.joinmode == 'SEMI' ) && !pass) {
			// Clear the scope after the loop
				scope[tableid] = {};
				doJoin(query,scope,h+1);
			}	


		}

// STEP 2

		if(h+1 < query.sources.length) {

			if(nextsource.joinmode == "OUTER" || nextsource.joinmode == "RIGHT" 
				|| nextsource.joinmode == "ANTI") {
		
				scope[source.alias] = {};
			
				for (var j=0; j<nextsource.data.length;j++){
					if(!nextsource.data[j]._rightjoin) {
						scope[nextsource.alias] = nextsource.data[j];
						doJoin(query, scope, h+2);
						nextsource.data[j]._rightjoin = undefined;
					}
				}

			};
		};

		scope[tableid] = undefined;

/*
		if(h+1 < query.sources.length) {
			var nextsource = query.sources[h+1];

			if(nextsource.joinmode == "OUTER" || nextsource.joinmode == "RIGHT" 
				|| nextsource.joinmode == "ANTI") {


				console.log(h,query.sources.length);
				// Swap


//				swapSources(query,h);

//				console.log(query.sources);
				//debugger;
//				var source = query.sources[h];

//				var tableid = source.alias || source.tableid; 
//				var data = source.data;

				// Reduce data for looping if there is optimization hint
//				if(source.optimization == 'ix') {
//					data = source.ix[ source.onleftfn(scope, query.params, alasql) ] || [];
//				}

				// Main cycle
				var pass = false;
//				console.log(tableid, data.length);
				for(var i=0, ilen=nextsource.data.length; i<ilen; i++) {
					scope[nextsource.tableid] = nextsource.data[i];
					// Reduce with ON and USING clause
					if(!source.onleftfn || (source.onleftfn(scope, query.params, alasql) == source.onrightfn(scope, query.params, alasql))) {
						// For all non-standard JOINs like a-b=0
						if(source.onmiddlefn(scope, query.params, alasql)) {
							// Recursively call new join
//							if(source.joinmode == "OUTER") {
								doJoin(query, scope, h+2);
//							}
							// for LEFT JOIN
							pass = true;
						}
					};
					if(!pass) {
					// Clear the scope after the loop
//						scope[tableid] = {};
						console.log(scope);
						doJoin(query,scope,h+2);
					}	
				};

				// Additional join for LEFT JOINS
					scope[query.sources[h+1].tableid] = {};
					console.log(scope);

				scope[tableid] = undefined;

				// SWAP BACK
				swapSources(query,h);

			}
		}

*/
	}

};

function swapSources(query, h) {
	var source = query.sources[h];
	var nextsource = query.sources[h+1];

	var onleftfn = source.onleftfn;
	var onleftfns = source.onleftfns;
	var onrightfn = source.onrightfn;
	var onrightfns = source.onrightfns;
	var optimization = source.optimization;

	source.onleftfn = nextsource.onrightfn;
	source.onleftfns = nextsource.onrightfns;
	source.onrightfn = nextsource.onleftfn;
	source.onrightfns = nextsource.onleftfns;
	source.optimization = nextsource.optimization;

	nextsource.onleftfn = onleftfn;
	nextsource.onleftfns = onleftfns;
	nextsource.onrightfn = onrightfn;
	nextsource.onrightfns = onrightfns;
	nextsource.optimization = optimization;

	query.sources[h] = nextsource;
	query.sources[h+1] = source;
}



/*
//
// Select run-time part for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

//
// Main part of SELECT procedure
//

yy.Select = function (params) { return yy.extend(this, params); }
yy.Select.prototype.toString = function() {
	var s = 'SELECT ';
	if(this.top) s += 'TOP '+this.top.value+' ';
	s += this.columns.map(function(col){
		var s = col.toString();
	//	console.log(col);
		if(col.as) s += ' AS '+col.as;
		return s;
	}).join(',');
	s += ' FROM '+this.from.map(function(f){
		console.log(f);
		var ss = f.toString();
		if(f.as) ss += ' AS '+f.as;
		return ss;
	}).join(',');

	if(this.where) s += ' WHERE '+this.where.toString();
	if(this.group) s += ' GROUP BY '+this.group.toString();
	if(this.having) s += ' HAVING '+this.having.toString();
	if(this.order) s += ' ORDER BY '+this.order.toString();
	if(this.union) s += ' UNION '+this.union.toString();
	if(this.unionall) s += ' UNION ALL '+this.unionall.toString();
	if(this.except) s += ' EXCEPT '+this.except.toString();
	if(this.intersect) s += ' INTERSECT '+this.intersect.toString();
	if(this.limit) s += ' LIMIT '+this.limit.value;
	if(this.offset) s += ' OFFSET '+this.offset.value;
	return s;
};

// Compile SELECT statement
yy.Select.prototype.compile = function(db) {
	// Create variable for query
	var query = {};

	query.database = db;
	// 0. Precompile whereexists
	this.compileWhereExists(query);

	// 0. Precompile queries for IN, NOT IN, ANY and ALL operators
	this.compileQueries(query);
	
	// 1. Compile FROM clause
	query.fromfn = this.compileFrom(query);
	// 2. Compile JOIN clauses
	if(this.joins) this.compileJoins(query);
	// 3. Compile SELECT clause
	query.selectfn = this.compileSelect(query);
	// 5. Optimize WHERE and JOINS
	if(this.where) this.compileWhereJoins(query);

	// 4. Compile WHERE clause
	query.wherefn = this.compileWhere(query);


	// 6. Compile GROUP BY
	if(this.group) query.groupfn = this.compileGroup(query);
	// 7. Compile DISTINCT, LIMIT and OFFSET
	query.distinct = this.distinct;

	if(this.top) {
		query.limit = this.top.value;
	} else if(this.limit) {
		query.limit = this.limit.value;
		if(this.offset) {
			query.offset = this.offset.value;
		}
	}
	// 8. Compile ORDER BY clause
	if(this.order) query.orderfn = this.compileOrder(query);

	// 9. Compile ordering function for UNION and UNIONALL
	if(this.union) {
		query.unionfn = this.union.compile(db);
		if(this.union.order) {
			query.orderfn = this.union.compileOrder(query);
		} else {
			query.orderfn = null;
		}
	} else if(this.unionall) {
		query.unionallfn = this.unionall.compile(db);
		if(this.unionall.order) {
			query.orderfn = this.unionall.compileOrder(query);
		} else {
			query.orderfn = null;
		}
	} else if(this.except) {
		query.exceptfn = this.except.compile(db);
		if(this.except.order) {
			query.orderfn = this.except.compileOrder(query);
		} else {
			query.orderfn = null;
		}
	} else if(this.intersect) {
		query.intersectfn = this.intersect.compile(db);
		if(this.intersect.order) {
			query.intersectfn = this.intersect.compileOrder(query);
		} else {
			query.orderfn = null;
		}
	};

//console.log(query);

	// Now, compile all togeather into one function with query object in scope
	return function(params, cb, oldscope) {
		query.params = params;
		var res = queryfn(query,oldscope); 
		if(cb) cb(res); 
		return res;
	}
};





/*
//
// EXISTS and other subqueries functions  functions for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.ExistsValue = function(params) { return yy.extend(this, params); }
yy.ExistsValue.prototype.toString = function() {
	return 'EXISTS('+this.value.toString()+')';
};

yy.ExistsValue.prototype.toJavaScript = function() {
//	return 'ww=this.existsfn['+this.existsidx+'](params,null,p).length,console.log(ww),ww';
	return 'this.existsfn['+this.existsidx+'](params,null,p).length';
};

yy.Select.prototype.compileWhereExists = function(query) {
	if(!this.exists) return;
	query.existsfn = this.exists.map(function(ex) {
		return ex.compile(query.database);
	});
};

yy.Select.prototype.compileQueries = function(query) {
	if(!this.queries) return;
	query.queriesfn = this.queries.map(function(q) {
		return q.compile(query.database);
	});
};

/*
//
// Select compiler part for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// SELECT Compile functions

// Stub for non-ecisting WHERE clause 
// so is faster then if(whenrfn) whenfn()
function returnTrue () {return true};

// Compile JOIN caluese
yy.Select.prototype.compileJoins = function(query) {
//	console.log(this);
//	debugger;
	var self = this;
	this.joins.forEach(function(jn){
		var tq = jn.table;
		var source = {
			alias: tq.alias||tq.tableid,
			databaseid: jn.databaseid || query.database.databaseid,
			tableid: tq.tableid,
			joinmode: jn.joinmode,
			onmiddlefn: returnTrue,
			srcwherefns: '',	// for optimization
			srcwherefn: returnTrue
		};

		source.datafn = function() {
			return query.database.tables[source.tableid].data;
		}


		var alias = tq.as || tq.tableid;
		query.aliases[alias] = {tableid: tq.tableid, databaseid: tq.databaseid || query.database.databaseid};

		if(jn.using) {
			var prevSource = query.sources[query.sources.length-1];
//			console.log(query.sources[0],prevSource,source);
			source.onleftfns = jn.using.map(function(colid){
				return "p['"+(prevSource.alias||prevSource.tableid)+"']['"+colid+"']";
			}).join('+"`"+');
			source.onleftfn = new Function('p,params,alasql','return '+source.onleftfns);
			source.onrightfns = jn.using.map(function(colid){
				return "p['"+(source.alias||source.tableid)+"']['"+colid+"']";
			}).join('+"`"+');
			source.onrightfn = new Function('p,params,alasql','return '+source.onrightfns);
			source.optimization = 'ix';
		} else if(jn.on) {
//console.log(jn.on);
			if(jn.on instanceof yy.Op && jn.on.op == '=' && !jn.on.allsome) {
//				console.log('ix optimization', jn.on.toJavaScript('p',query.defaultTableid) );
				source.optimization = 'ix';
			// 	source.onleftfns = jn.on.left.toJavaScript('p',query.defaultTableid);
			// 	source.onleftfn = new Function('p', 'return '+source.onleftfns);
			// 	source.onrightfns = jn.on.right.toJavaScript('p',query.defaultTableid);
			// 	source.onrightfn = new Function('p', 'return '+source.onrightfns);

				var lefts = '';
				var rights = '';
				var middles = '';
				var middlef = false;
				// Test right and left sides
				var ls = jn.on.left.toJavaScript('p',query.defaultTableid);
				var rs = jn.on.right.toJavaScript('p',query.defaultTableid);

				if((ls.indexOf("p['"+alias+"']")>-1) && !(rs.indexOf("p['"+alias+"']")>-1)){
					if((ls.match(/p\[\'.*?\'\]/g)||[]).every(function(s){ 
						return s == "p['"+alias+"']"})) { rights = ls; } 
						else { middlef = true };

				} else 	if(!(ls.indexOf("p['"+alias+"']")>-1) && (rs.indexOf("p['"+alias+"']")>-1)){
					if((rs.match(/p\[\'.*?\'\]/g)||[]).every(function(s){ 
						return s == "p['"+alias+"']"})) { lefts = ls; } 
						else { middlef = true };
				} else {
					middlef = true;
				}

//				console.log(alias, 1,lefts, rights, middlef);

				if((rs.indexOf("p['"+alias+"']")>-1) && !(ls.indexOf("p['"+alias+"']")>-1)){
					if((rs.match(/p\[\'.*?\'\]/g)||[]).every(function(s){ 
						return s == "p['"+alias+"']"})) { rights = rs; } 
						else { middlef = true };
				} else if(!(rs.indexOf("p['"+alias+"']")>-1) && (ls.indexOf("p['"+alias+"']")>-1)){
					if((ls.match(/p\[\'.*?\'\]/g)||[]).every(function(s){ 
						return s == "p['"+alias+"']"})) { lefts = rs; } 
						else { middlef = true };
				} else {
					middlef = true;
				}

//				console.log(alias, 2,lefts, rights, middlef);

				if(middlef) {
//					middles = jn.on.toJavaScript('p',query.defaultTableid);
//				} else {
					rights = '';
					lefts = '';
					middles = jn.on.toJavaScript('p',query.defaultTableid);
					source.optimization = 'no';
					// What to here?
				} 

				source.onleftfns = lefts;
				source.onrightfns = rights;
				source.onmiddlefns = middles || 'true';
//			console.log(source.onleftfns, '-',source.onrightfns, '-',source.onmiddlefns);

				source.onleftfn = new Function('p,params,alasql', 'return '+source.onleftfns);
				source.onrightfn = new Function('p,params,alasql', 'return '+source.onrightfns);
				source.onmiddlefn = new Function('p,params,alasql', 'return '+source.onmiddlefns);

//			} else if(jn.on instanceof yy.Op && jn.on.op == 'AND') {
//				console.log('join on and ',jn);

			} else {
//				console.log('no optimization');
				source.optimization = 'no';
//				source.onleftfn = returnTrue;
//				source.onleftfns = "true";
				source.onmiddlefns = jn.on.toJavaScript('p',query.defaultTableid);
				source.onmiddlefn = new Function('p,params,alasql','return '+jn.on.toJavaScript('p',query.defaultTableid));
			};
//			console.log(source.onleftfns, source.onrightfns, source.onmiddlefns);

			// Optimization function
		};

//		source.data = alasql.databases[source.databaseid].tables[source.tableid].data;
//console.log(source, jn);
		// TODO SubQueries
		if(!query.database.tables[source.tableid]) {
			throw new Error('Table \''+source.tableid+
			'\' is not exists in database \''+query.database.databaseid)+'\'';
		};
		source.data = query.database.tables[source.tableid].data;
/*		if(source.joinmode == 'RIGHT') {
			var prevSource = query.sources.pop();
			if(prevSource.joinmode == 'INNER') {
				prevSource.joinmode = 'LEFT';
				var onleftfn = prevSource.onleftfn;
				var onleftfns = prevSource.onleftfns;
				var onrightfn = prevSource.onrightfn;
				var onrightfns = prevSource.onrightfns;
				var optimization = prevSource.optimization;

				prevSource.onleftfn = source.onrightfn;
				prevSource.onleftfns = source.onrightfns;
				prevSource.onrightfn = source.onleftfn;
				prevSource.onrightfns = source.onleftfns;
				prevSource.optimization = source.optimization;

				source.onleftfn = onleftfn;
				source.onleftfns = onleftfns;
				source.onrightfn = onrightfn;
				source.onrightfns = onrightfns;
				source.optimization = optimization;

				source.joinmode = 'INNER';
				query.sources.push(source);
				query.sources.push(prevSource);
			} else {
				throw new Error('Do not know how to process this SQL');
			}
		} else {
			query.sources.push(source);
		}
*/	
		query.sources.push(source);
	});
//	console.log('sources',query.sources);
}


// Compile group of statements
yy.Select.prototype.compileGroup = function(query) {
	var self = this;

	var allgroup = decartes(this.group);

	//console.log(allgroup);
	// Prepare groups
	//var allgroup = [['a'], ['a','b'], ['a', 'b', 'c']];

	// Union all arrays to get a maximum
	var allgroups = [];
	allgroup.forEach(function(a){
		allgroups = arrayUnion(allgroups, a);
	});

	// Create negative array

	var s = '';

	allgroup.forEach(function(agroup) {


		// Start of group function
		s += 'var g=this.xgroups[';

	//	var gcols = this.group.map(function(col){return col.columnid}); // Group fields with r
		// Array with group columns from record
		var rg = agroup.map(function(columnid){
			// Check, if aggregator exists but GROUP BY is not exists
			if(columnid == '') return '1'; // Create fictive groupping column for fictive GROUP BY
			else return "r['"+columnid+"']";
		});

		if(rg.length == 0) rg = ["''"];

	//	console.log('rg',rg);

		s += rg.join('+"`"+');
		s += '];if(!g) {this.groups.push(g=this.xgroups[';
		s += rg.join('+"`"+');
		s += '] = {';
	//	s += ']=r';

		s += agroup.map(function(columnid){
			if(columnid == '') return '';
			else return "'"+columnid+"':r['"+columnid+"'],";
		}).join('');


		var neggroup = arrayDiff(allgroups,agroup);

		s += neggroup.map(function(columnid){
			return "'"+columnid+"':null,";
		}).join('');


		s += self.columns.map(function(col){
			if (col instanceof yy.AggrValue) { 
				if (col.aggregatorid == 'SUM'
					|| col.aggregatorid == 'MIN'
					|| col.aggregatorid == 'MAX'
					|| col.aggregatorid == 'FIRST'
					|| col.aggregatorid == 'LAST'
					|| col.aggregatorid == 'AVG'
//				) { return '\''+col.as+'\':r[\''+col.as+'\'],'; }//f.field.arguments[0].toJavaScript(); 	
				) { return '\''+col.as+'\':r[\''+col.as+'\'],'; }//f.field.arguments[0].toJavaScript(); 	
				else if(col.aggregatorid == 'COUNT') { return '\''+col.as+'\':1,'; }
//				else if(col.aggregatorid == 'MIN') { return '\''+col.as+'\':r[\''+col.as+'\'],'; }
//				else if(col.aggregatorid == 'MAX') { return '\''+col.as+'\':r[\''+col.as+'\'],'; }
	//			else if(col.aggregatorid == 'AVG') { srg.push(col.as+':0'); }
				return '';
			} else return '';
		}).join('');





		// columnid:r.columnid
	//	var srg = [];//rg.map(function(fn){ return (fn+':'+fn); });

	//	var srg = this.group.map(function(col){
	//		if(col == '') return '';
	//		else return col.columnid+':'+col.toJavaScript('r','');
	//	});

	// Initializw aggregators

	/*
		this.columns.forEach(function(col){
	//		console.log(f);
	//			if(f.constructor.name == 'LiteralValue') return '';


			if (col instanceof yy.AggrValue) { 
				if (col.aggregatorid == 'SUM') { srg.push("'"+col.as+'\':0'); }//f.field.arguments[0].toJavaScript(); 	
				else if(col.aggregatorid == 'COUNT') {srg.push( "'"+col.as+'\':0'); }
				else if(col.aggregatorid == 'MIN') { srg.push( "'"+col.as+'\':Infinity'); }
				else if(col.aggregatorid == 'MAX') { srg.push( "'"+col.as+'\':-Infinity'); }
	//			else if(col.aggregatorid == 'AVG') { srg.push(col.as+':0'); }
	//				return 'group.'+f.name.value+'=+(+group.'+f.name.value+'||0)+'+f.field.arguments[0].toJavaScript('rec','')+';'; //f.field.arguments[0].toJavaScript(); 	
			};

		});

	*/

	/*****************/

	//	s += srg.join(',');

		// var ss = [];
		// gff.forEach(function(fn){
		// 	ss.push(fn+':rec.'+fn);
		// });
		// s += ss.join(',');
	//	s += '});};';

		s += '});} else {';
	//	console.log(s, this.columns);



	// var neggroup = arrayDiff(allgroups,agroup);

	// console.log(agroup,neggroup);

	// s += neggroup.map(function(columnid){
	// 	return "g['"+columnid+"']=null;";
	// }).join('');

	// console.log(s);


	//console.log(query.selectfn);
		s += self.columns.map(function(col){
			if (col instanceof yy.AggrValue) { 
				if (col.aggregatorid == 'SUM') { return 'g[\''+col.as+'\']+=r[\''+col.as+'\'];'; }//f.field.arguments[0].toJavaScript(); 	
				else if(col.aggregatorid == 'COUNT') { return 'g[\''+col.as+'\']++;'; }
				else if(col.aggregatorid == 'MIN') { return 'g[\''+col.as+'\']=Math.min(g[\''+col.as+'\'],r[\''+col.as+'\']);'; }
				else if(col.aggregatorid == 'MAX') { return 'g[\''+col.as+'\']=Math.max(g[\''+col.as+'\'],r[\''+col.as+'\']);'; }
				else if(col.aggregatorid == 'FIRST') { return ''; }
				else if(col.aggregatorid == 'LAST') { return 'g[\''+col.as+'\']=r[\''+col.as+'\'];'; }
				else if(col.aggregatorid == 'AVG') { return ''; }
	//			else if(col.aggregatorid == 'AVG') { srg.push(col.as+':0'); }
				return '';
			} else return '';
		}).join('');


	//	s += selectFields.map(function(f){
	//			console.log(f);
	//			if(f.constructor.name == 'LiteralValue') return '';
	//			if (f.field instanceof SQLParser.nodes.FunctionValue 
	//				&& (f.field.name.toUpperCase() == 'SUM' || f.field.name.toUpperCase() == 'COUNT')) {
	//				return 'group.'+f.name.value+'=+(+group.'+f.name.value+'||0)+'+f.field.arguments[0].toJavaScript('rec','')+';'; //f.field.arguments[0].toJavaScript(); 	
	//				return 'group.'+f.name.value+'+='+f.field.arguments[0].toJavaScript('rec','')+';'; //f.field.arguments[0].toJavaScript(); 	
	//				return 'group.'+f.name.value+'+=rec.'+f.name.value+';'; //f.field.arguments[0].toJavaScript(); 	
	//			};
	//			return '';
	//		}).join('');

		//s += '	group.amt += rec.emplid;';
		//s += 'group.count++;';

		s += '}';
	//	console.log(s, this.group);

	});

//	console.log(s);
	return new Function('r,params',s);

}

yy.Select.prototype.compileFrom = function(query) {
	var self = this;
	query.sources = [];
//	var tableid = this.from[0].tableid;
//	var as = '';
//	if(self.from[0].as) as = this.from[0].as;
//console.log(this);
	query.aliases = {};
	self.from.forEach(function(tq){
		var alias = tq.as || tq.tableid;
//		console.log(alias);
		if(tq instanceof yy.Table) {
//			console.log(tq, tq.databaseid, query);
			query.aliases[alias] = {tableid: tq.tableid, databaseid: tq.databaseid || query.database.databaseid, type:'table'};
		} else if(tq instanceof yy.Select) {
			query.aliases[alias] = {type:'subquery'};
		} else if(tq instanceof yy.ParamValue) {
			query.aliases[alias] = {type:'paramvalue'};
		} else {
			throw new Error('Wrong table at FROM');
		}

		var source = {
			alias: alias,
			databaseid: tq.databaseid || query.database.databaseid,
			tableid: tq.tableid,
			joinmode: 'INNER',
			onmiddlefn: returnTrue,			
			srcwherefns: '',	// for optimization
			srcwherefn: returnTrue			
		};

		if(tq instanceof yy.Table) {
			source.datafn = function() {
				return query.database.tables[source.tableid].data;
			}
		} else if(tq instanceof yy.Select) {
			source.subquery = tq.compile(query.database);
			source.datafn = function() {
				return source.subquery(query.params);
			}						
		} else if(tq instanceof yy.ParamValue) {
			source.datafn = new Function('params',
				"return params['"+tq.param+"'];");
		} else {
			throw new Error('Wrong table at FROM');
		}
//		source.data = alasql.databases[source.databaseid].tables[source.tableid].data;
		query.sources.push(source);

	});
	// TODO Add joins
	query.defaultTableid = query.sources[0].alias;
//console.log(query.defaultTableid);
};

// yy.Select.prototype.compileSources = function(query) {
// 	return sources;
// };

function compileSelectStar (query,alias) {
	// console.log(query.aliases[alias]);
//	console.log(query,alias);
	// console.log(query.aliases[alias].tableid);
	var s = '', sp = '', ss=[];
	if(query.aliases[alias].tableid) {
		var columns = query.database.tables[query.aliases[alias].tableid].columns;
	};
	if(columns) {
		columns.forEach(function(tcol){
			ss.push(tcol.columnid+':p[\''+alias+'\'][\''+tcol.columnid+'\']');

//		console.log('ok',s);

			var coldef = {
				columnid:tcol.columnid, 
				dbtypeid:tcol.dbtypeid, 
				dbsize:tcol.dbsize, 
				dbpecision:tcol.dbprecision
			};
			query.columns.push(coldef);
			query.xcolumns[coldef.columnid]=coldef;

		});
	} else {
		// if column not exists, then copy all
		sp += 'var w=p["'+alias+'"];for(var k in w){r[k]=w[k]};';
		query.dirtyColumns = true;
	}
	return {s:ss.join(','),sp:sp};
}


yy.Select.prototype.compileSelect = function(query) {
	var self = this;
	query.columns = [];
	query.xcolumns = {};
	query.dirtyColumns = false;
	var s = 'var r={';
	var sp = '';
	var ss = [];
	this.columns.forEach(function(col){
		if(col instanceof yy.Column) {
			if(col.columnid == '*') {
				if(col.tableid) {
					//Copy all
					var ret = compileSelectStar(query, col.tableid);
					if(ret.s)  ss = ss.concat(ret.s);
					sp += ret.sp;

				} else {
//					console.log('aliases', query.aliases);
					for(var alias in query.aliases) {
						var ret = compileSelectStar(query, alias); //query.aliases[alias].tableid);
						if(ret.s) ss = ss.concat(ret.s);
						sp += ret.sp;
					}
					// TODO Remove these lines
					// In case of no information 
					// sp += 'for(var k1 in p){var w=p[k1];'+
					// 			'for(k2 in w) {r[k2]=w[k2]}}'
				}
			} else {
				// If field, otherwise - expression
				ss.push((col.as || col.columnid)+':p[\''+(col.tableid||query.defaultTableid)+'\'][\''+col.columnid+'\']');

				if(query.aliases[col.tableid||query.defaultTableid] && query.aliases[col.tableid||query.defaultTableid].type == 'table') {

					if(!query.database.tables[query.aliases[col.tableid||query.defaultTableid].tableid]) {
						throw new Error('Table \''+(col.tableid||query.defaultTableid)+'\' does not exists in database');
					}
					var xcolumns = query.database.tables[query.aliases[col.tableid||query.defaultTableid].tableid].xcolumns;

					if(xcolumns) {
						var tcol = xcolumns[col.columnid];
						var coldef = {
							columnid:col.as || col.columnid, 
							dbtypeid:tcol.dbtypeid, 
							dbsize:tcol.dbsize, 
							dbpecision:tcol.dbprecision
						};
						query.columns.push(coldef);
						query.xcolumns[coldef.columnid]=coldef;
					} else {
						query.dirtyColumns = true;
					}
				} else {
					// This is a subquery? 
					// throw new Error('There is now such table \''+col.tableid+'\'');
				};

			}
		} else if(col instanceof yy.AggrValue) {
			if(!self.group) {
//				self.group=[new yy.Column({columnid:'q',as:'q'	})];
				self.group = [''];
			}
			if(!col.as) col.as = col.toString();
			if (col.aggregatorid == 'SUM' || col.aggregatorid == 'MAX' ||  col.aggregatorid == 'MIN' ||
				col.aggregatorid == 'FIRST' || col.aggregatorid == 'LAST' ||  col.aggregatorid == 'AVG'
				) {
				ss.push("'"+col.as+'\':'+col.expression.toJavaScript("p",query.defaultTableid))	
			} else if (col.aggregatorid == 'COUNT') {
				ss.push("'"+col.as+"':1");
				// Nothing
			} 
//			else if (col.aggregatorid == 'MAX') {
//				ss.push((col.as || col.columnid)+':'+col.toJavaScript("p.",query.defaultTableid))
//			} else if (col.aggregatorid == 'MIN') {
//				ss.push((col.as || col.columnid)+':'+col.toJavaScript("p.",query.defaultTableid))
//			}
		} else {
			ss.push('\''+(col.as || col.columnid || col.toString())+'\':'+col.toJavaScript("p",query.defaultTableid));
			//if(col instanceof yy.Expression) {
		}
	});
	s += ss.join(',')+'};'+sp;
//	console.log(s);
	query.selectfns = s;
	return new Function('p,params,alasql',s+'return r');
};

yy.Select.prototype.compileWhere = function(query) {
	if(this.where) {
		s = this.where.toJavaScript('p',query.defaultTableid);
		query.wherefns = s;
//		console.log(s);
		return new Function('p,params,alasql','return '+s);
	} else return function(){return true};
};

yy.Select.prototype.compileWhereJoins = function(query) {
//	console.log(this.where);
	optimizeWhereJoin(query, this.where.expression);

	//for sources compile wherefs
	query.sources.forEach(function(source) {
		if(source.srcwherefns) {
			source.srcwherefn = new Function('p,params,alasql','return '+source.srcwherefns);
		};
		if(source.wxleftfns) {
			source.wxleftfn = new Function('p,params,alasql','return '+source.wxleftfns);
		};
		if(source.wxrightfns) {
			source.wxrightfn = new Function('p,params,alasql','return '+source.wxrightfns);
		};
//		console.log(source.alias, source.wherefns)
//		console.log(source);
	});
};

function optimizeWhereJoin (query, ast) {
	if(!ast) return false;
	var s = ast.toJavaScript('p',query.defaultTableid);
	var fsrc = [];
	query.sources.forEach(function(source,idx) {

		// This is a good place to remove all unnecessary optimizations
		if(s.indexOf('p[\''+source.alias+'\']')>-1) fsrc.push(source);
	});
//	console.log(ast);
//	console.log(s);
//	console.log(fsrc.length);
	if(fsrc.length == 0) {
//		console.log('no optimization, can remove this part of ast');
		return;
	} else if (fsrc.length == 1) {

		if(!(s.match(/p\[\'.*?\'\]/g)||[])
			.every(function(s){ 
						return s == "p['"+fsrc[0].alias+"']"})) { 
			return; 
			// This is means, that we have column from parent query
			// So we return without optimization
		} 

		var src = fsrc[0]; // optmiization source
		src.srcwherefns = src.srcwherefns ? src.srcwherefns+'&&'+s : s;

		if((ast instanceof yy.Op) && (ast.op == '=' && !ast.allsome)) {
			if(ast.left instanceof yy.Column) {
				var ls = ast.left.toJavaScript('p',query.defaultTableid);
				var rs = ast.right.toJavaScript('p',query.defaultTableid);
				if(rs.indexOf('p[\''+fsrc[0].alias+'\']') == -1) {
					fsrc[0].wxleftfns = ls; 
					fsrc[0].wxrightfns = rs; 
				} 
			} if(ast.right instanceof yy.Column) {
				var ls = ast.left.toJavaScript('p',query.defaultTableid);
				var rs = ast.right.toJavaScript('p',query.defaultTableid);
				if(ls.indexOf('p[\''+fsrc[0].alias+'\']') == -1) {
					fsrc[0].wxleftfns = rs; 
					fsrc[0].wxrightfns = ls; 
				} 
			}
		}
		ast.reduced = true;  // To do not duplicate wherefn and srcwherefn
		return;
	} else {
		if(ast.op = 'AND') {
			optimizeWhereJoin(query,ast.left);
			optimizeWhereJoin(query,ast.right);
		} 
	}

};


yy.Select.prototype.compileOrder = function (query) {
	if(this.order) {
		var s = '';
		var sk = '';
		this.order.forEach(function(ord){
			var columnid = ord.expression.columnid; 
			
			// Date conversion
			var dg = ''; 
			if(query.xcolumns[columnid]) {
				var dbtypeid = query.xcolumns[columnid].dbtypeid;
				if( dbtypeid == 'DATE' || dbtypeid == 'DATETIME') dg = '.valueOf()';
				// TODO Add other types mapping
			} else {
				dg = '.valueOf()';
			}
			
			// COLLATE NOCASE
			if(ord.nocase) columnid += '.toUpperCase()';

			// TODO Add date comparision
			s += 'if(a[\''+columnid+"']"+dg+(ord.direction == 'ASC'?'>':'<')+'b[\''+columnid+"']"+dg+')return 1;';
			s += 'if(a[\''+columnid+"']"+dg+'==b[\''+columnid+"']"+dg+'){';
			sk += '}';
		});
		s += 'return 0;';
		s += sk+'return -1';
		query.orderfns = s;

		return new Function('a,b',s);
	};
};



/*
//
// ROLLUP(), CUBE(), GROUPING SETS() for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// Calculate ROLLUP() combination

var rollup = function (a) {
	var rr = [];
	var mask = 0;
	var glen = a.length;
	for(var g=0;g<glen+1;g++) {
		var ss = [];
		for(var i=0;i<glen;i++) {
			if(mask&(1<<i)) ss.push(a[i]);
		}
		rr.push(ss);
		mask = (mask<<1)+1; 
	};
	return rr;
};

// Calculate CUBE()
var cube = function (a) {
	var rr = [];
	var glen = a.length;
	for(var g=0;g<(1<<glen);g++) {
		var ss = [];
		for(var i=0;i<glen;i++) {
			if(g&(1<<i)) //ss.push(a[i]);
				//ss = cartes(ss,decartes(a[i]));
				ss = ss.concat(decartes(a[i]));
				//
		}
		rr.push(ss);
	}
	return rr;
}

// GROUPING SETS()
var groupingsets = function(a) {
	return a.reduce(function(acc,d){
		acc = acc.concat(decartes(d));
		return acc;
	}, []);
}

// Cartesian production
var cartes = function(a1,a2){
	var rrr =[];
	for(var i1=0;i1<a1.length;i1++) {
		for(var i2=0;i2<a2.length;i2++) {
			rrr.push(a1[i1].concat(a2[i2]));
		}
	};
	return rrr;
}

// Prepare function
function decartes(gv) {
//	console.log(gv);
	if(gv instanceof Array) {
		var res = [[]];
		for(var t=0; t<gv.length; t++) {
			if(gv[t] instanceof yy.Column) {
		 		res = res.map(function(r){return r.concat(gv[t].columnid)}); 	
			} else if(gv[t] instanceof yy.GroupExpression) {
				if(gv[t].type == 'ROLLUP') res = cartes(res,rollup(gv[t].group));
				else if(gv[t].type == 'CUBE') res = cartes(res,cube(gv[t].group));
				else if(gv[t].type == 'GROUPING SETS') res = cartes(res,groupingsets(gv[t].group));
			} else {
//				res = res.concat(gv[t]);
			};

			// switch(gv[t].t) {
			// 	case 'plain': 
			// 		res = res.map(function(r){return r.concat(gv[t].p)}); 

			// 	break; 
			// 	case 'rollup': res = cartes(res,rollup(gv[t].p)); break; 
			// 	case 'cube': res = cartes(res,cube(gv[t].p)); break; 
			// 	case 'groupingsets': res = cartes(res,groupingsets(gv[t].p)); break; 
			// 	default: res = res.concat(gv[t]);
			// }
		}
		return res;
	} else {
		if(gv instanceof yy.Column) return [gv.columnid];

		// switch(gv.t) {
		// 	case 'plain': return gv.p; break;
		// 	case 'rollup': return rollup(gv.p); break; 
		// 	case 'cube': return cube(gv.p); break; 
		// 	case 'groupingsets':  return groupingsets(gv.p); break; 
		// 	default: return [gv];//return decartes(gv.p);
		// }
		// return gv;
	}
}


/*
//
// UNION for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// SELECT UNION statement

yy.Union = function (params) { return yy.extend(this, params); }
yy.Union.prototype.toString = function () {
	return "UNION";
};

yy.Union.prototype.compile = function (tableid) {
	return null;
};

/*
//
// Expressions for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.Expression = function(params) { return yy.extend(this, params); };
yy.Expression.prototype.toString = function() {
	return this.expression.toString();
};
yy.Expression.prototype.toJavaScript = function(context, tableid) {
//	console.log('Expression',this);
	if(this.expression.reduced) return 'true';
	return this.expression.toJavaScript(context, tableid);
};
yy.Expression.prototype.compile = function(context, tableid){
//	console.log('Expression',this);
	if(this.reduced) return returnTrue();
	return new Function('p','return '+this.toJavaScript(context, tableid));
};


yy.Literal = function (params) { return yy.extend(this, params); }
yy.Literal.prototype.toString = function() {
	var s = this.value;
	if(this.value1) s = this.value1+'.'+s; 
//	else s = tableid+'.'+s;
	return s;
}


yy.Join = function (params) { return yy.extend(this, params); }
yy.Join.prototype.toString = function() {
	return 'JOIN'+this.table.toString();
}
//yy.Join.prototype.toJavaScript = function(context, tableid) {
//	return 'JOIN'+this.table.toString();
//}


yy.Table = function (params) { return yy.extend(this, params); }
yy.Table.prototype.toString = function() {
	var s = this.tableid;
	if(this.databaseid) s = this.databaseid+'.'+s;
	return s;
};


yy.Op = function (params) { return yy.extend(this, params); }
yy.Op.prototype.toString = function() {
	if(this.op == 'IN' || this.op == 'NOT IN') {
		return this.left.toString()+" "+this.op+" ("+this.right.toString()+")";
	}
	if(this.allsome) {
		return this.left.toString()+" "+this.op+" "+this.allsome+' ('+this.right.toString()+')';
	}
	return this.left.toString()+" "+this.op+" "+(this.allsome?this.allsome+' ':'')+this.right.toString();
};

yy.Op.prototype.toJavaScript = function(context,tableid) {
//	console.log(this);
	var op = this.op;
	if(this.op == '=') op = '===';
	else if(this.op == '<>') op = '!=';
	else if(this.op == 'OR') op = '||';

	if(this.op == 'LIKE') {
		var s = '('+this.left.toJavaScript(context,tableid)+')'+
		".match(new RegExp(("+this.right.toJavaScript(context,tableid)+").replace(/\\\%/g,'.*'),'g'))"
//		console.log(s);
		return s;
	};

	if(this.op == 'BETWEEN') {
		if(this.right instanceof yy.Op && this.right.op == 'AND') {
			return '(('+this.right.left.toJavaScript(context,tableid)+'<='+this.left.toJavaScript(context,tableid)+')&&'+
			'('+this.left.toJavaScript(context,tableid)+'<='+this.right.right.toJavaScript(context,tableid)+'))';		
		} else {
			throw new Error('Wrong BETWEEM operator without AND part');
		}
	};

	if(this.op == 'NOT BETWEEN') {
		if(this.right instanceof yy.Op && this.right.op == 'AND') {
			return '!(('+this.right.left.toJavaScript(context,tableid)+'<='+this.left.toJavaScript(context,tableid)+')&&'+
			'('+this.left.toJavaScript(context,tableid)+'<='+this.right.right.toJavaScript(context,tableid)+'))';		
		} else {
			throw new Error('Wrong NOT BETWEEM operator without AND part');
		}
	};

	if(this.op == 'IN') {
		if(this.right instanceof yy.Select ) {
			var s = '(this.queriesdata['+this.queriesidx+'].indexOf(';
			s += this.left.toJavaScript(context,tableid)+')>-1)';
			return s;
		} else if(this.right instanceof Array ) {
			var s = '(['+this.right.map(function(a){return a.toJavaScript(context,tableid)}).join(',')+'].indexOf(';
			s += this.left.toJavaScript(context,tableid)+')>-1)';
			return s;
		} else {
			throw new Error('Wrong IN operator without SELECT part');
		}
	};


	if(this.op == 'NOT IN') {
		if(this.right instanceof yy.Select ) {
			var s = '(this.queriesdata['+this.queriesidx+'].indexOf(';
			s += this.left.toJavaScript(context,tableid)+')<0)';
			return s;
		} else if(this.right instanceof Array ) {
			var s = '(['+this.right.map(function(a){return a.toJavaScript(context,tableid)}).join(',')+'].indexOf(';
			s += this.left.toJavaScript(context,tableid)+')<0)';
			return s;
		} else {
			throw new Error('Wrong NOT IN operator without SELECT part');
		}
	};

	if(this.allsome == 'ALL') {
		if(this.right instanceof yy.Select ) {
			var s = 'this.queriesdata['+this.queriesidx+'].every(function(b){return (';
			s += this.left.toJavaScript(context,tableid)+')'+op+'b})';
			return s;
		} else if(this.right instanceof Array ) {
			var s = '['+this.right.map(function(a){return a.toJavaScript(context,tableid)}).join(',')+'].every(function(b){return (';
			s += this.left.toJavaScript(context,tableid)+')'+op+'b})';
			return s;
		} else {
			throw new Error('Wrong NOT IN operator without SELECT part');
		}		
	};

	if(this.allsome == 'SOME' || this.allsome == 'ANY') {
		if(this.right instanceof yy.Select ) {
			var s = 'this.queriesdata['+this.queriesidx+'].some(function(b){return (';
			s += this.left.toJavaScript(context,tableid)+')'+op+'b})';
			return s;
		} else if(this.right instanceof Array ) {
			var s = '['+this.right.map(function(a){return a.toJavaScript(context,tableid)}).join(',')+'].some(function(b){return (';
			s += this.left.toJavaScript(context,tableid)+')'+op+'b})';
			return s;
		} else {
			throw new Error('Wrong NOT IN operator without SELECT part');
		}		
	};

// Special case for AND optimization (if reduced)
	if(this.op == 'AND') {
		if(this.left.reduced) {
			if(this.right.reduced) {
				return 'true';
			} else {
				return this.right.toJavaScript(context,tableid);
			}
		} else if(this.right.reduced) {
			return this.left.toJavaScript(context,tableid);
		}			

		// Otherwise process as regular operation (see below)
		op = '&&';

	}


	// Change names
//	console.log(this);
	return '('+this.left.toJavaScript(context,tableid)+op+this.right.toJavaScript(context,tableid)+')';
};



yy.NumValue = function (params) { return yy.extend(this, params); }
yy.NumValue.prototype.toString = function() {
	return this.value.toString();
};

yy.NumValue.prototype.toType = function() {
	return 'number';
};

yy.NumValue.prototype.toJavaScript = function() {
	return ""+this.value;
}


yy.StringValue = function (params) { return yy.extend(this, params); }
yy.StringValue.prototype.toString = function() {
	return "'"+this.value.toString()+"'";
}

yy.StringValue.prototype.toType = function() {
	return 'string';
}

yy.StringValue.prototype.toJavaScript = function() {
	return "'"+this.value+"'";
}


yy.LogicValue = function (params) { return yy.extend(this, params); }
yy.LogicValue.prototype.toString = function() {
	return this.value?'TRUE':'FALSE';
}

yy.LogicValue.prototype.toType = function() {
	return 'boolean';
}

yy.LogicValue.prototype.toJavaScript = function() {
	return this.value?'true':'false';
}

yy.NullValue = function (params) { return yy.extend(this, params); }
yy.NullValue.prototype.toString = function() {
	return 'NULL';
}
yy.NullValue.prototype.toJavaScript = function() {
	return 'null';
}

yy.ParamValue = function (params) { return yy.extend(this, params); }
yy.ParamValue.prototype.toString = function() {
	return '$'+this.param;
}
yy.ParamValue.prototype.toJavaScript = function() {
	if(typeof this.param == "string") return "params[\'"+this.param+"\']";
	else return "params["+this.param+"]";
}



yy.UniOp = function (params) { return yy.extend(this, params); }
yy.UniOp.prototype.toString = function() {
	if(this.op == '-') return this.op+this.right.toString();
	if(this.op == 'NOT') return this.op+'('+this.right.toString()+')';
	else if(this.op == null) return '('+this.right.toString()+')';
};

yy.UniOp.prototype.toJavaScript = function(context, tableid) {
	if(this.op == '-') return "-"+this.right.toJavaScript(context, tableid);
	if(this.op == 'NOT') return '!('+this.right.toJavaScript(context, tableid)+')';
	else if(this.op == null) return '('+this.right.toJavaScript(context, tableid)+')';
};



// yy.Star = function (params) { return yy.extend(this, params); }
// yy.Star.prototype.toString = function() {
// 	var s = this.fieldid;
// 	if(this.tableid) {
// 		s = this.tableid+'.'+s;
// 		if(this.databaseid) {
// 			s = this.databaseid+'.'+s;
// 		}
// 	}
// 	if(this.alias) s += ' AS '+this.alias;
// 	return s;
// }

yy.Column = function(params) { return yy.extend(this, params); }
yy.Column.prototype.toString = function() {
	var s;
	if(this.columnid == +this.columnid) {
		s = '['+this.columnid+']';
	} else {
		s = this.columnid;
	}
	if(this.tableid) {
		if(+this.columnid == this.columnid) {
			s = this.tableid+s;
		} else {
			s = this.tableid+'.'+s;
		}
		if(this.databaseid) {
			s = this.databaseid+'.'+s;
		}
	}
//	if(this.alias) s += ' AS '+this.alias;
	return s;
};

yy.Column.prototype.toJavaScript = function(context, tableid) {
//	var s = this.value;
// 	var s = this.columnid;
// 	if(this.tableid) {
// 		s = this.tableid+'.'+s;
// //		if(this.databaseid) {
// //			s = this.databaseid+'.'+s;
// //		}
// 	} else {
// 		s = tableid+'.'+s;
// 	}
//console.log('yy.Column',this, tableid);
	var s = '';
	if(tableid == '') {
		s = context+'[\''+this.columnid+'\']';
	} else {
		s = context+'[\''+(this.tableid || tableid) + '\'][\''+this.columnid+'\']';
	}
//	console.log(context,s);
//	console.trace(new Error());
	return s;
}




yy.AggrValue = function(params){ return yy.extend(this, params); }
yy.AggrValue.prototype.toString = function() {
	var s = this.aggregatorid+'(';
	if(this.expression) s += this.expression.toString();
	s += ')';
//	if(this.alias) s += ' AS '+this.alias;
	return s;
}

yy.AggrValue.prototype.toJavaScript = function(context, tableid) {
//	var s = 'alasql.functions.'+this.funcid+'(';
//	if(this.expression) s += this.expression.toJavaScript(context, tableid);
//	s += ')';
//	if(this.alias) s += ' AS '+this.alias;
//	return s;
	return '';
}


yy.OrderExpression = function(params){ return yy.extend(this, params); }
yy.OrderExpression.prototype.toString = function() {
	var s = this.expression.toString();
	if(this.order) s += ' '+this.order.toString();
	return s;
}

yy.GroupExpression = function(params){ return yy.extend(this, params); }
yy.GroupExpression.prototype.toString = function() {
	return this.type+'('+this.group.toString()+')';
}


yy.ColumnDef = function (params) { return yy.extend(this, params); }
yy.ColumnDef.prototype.toString = function() {
	var s =  this.columnid;
	if(this.dbtypeid) s += ' '+this.dbtypeid;
	if(this.dbsize) {
		s += '('+this.dbsize;
		if(this.dbprecision) s += ','+this.dbprecision;
		s += ')';
	};
	if(this.primarykey) s += ' PRIMARY KEY';
	if(this.notnull) s += ' NOT NULL';
	return s;
}


/*
//
// Functions for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.FuncValue = function(params){ return yy.extend(this, params); }
yy.FuncValue.prototype.toString = function() {
	var s = '';
    if(alasql.stdlib[funcid]) s += this.funcid.substr(1).toUpperCase();
    else s += this.funcid.substr(1).toLowerCase();
    
    s += '(';
	if(this.args && this.args.length > 0) {
		s += this.args.map(function(arg){
			return arg.toString();
		}).join(',');
	};
	s += ')';
//	if(this.alias) s += ' AS '+this.alias;
	return s;
}

yy.FuncValue.prototype.toJavaScript = function(context, tableid) {
	var s = '';
    var funcid = this.funcid;
	// IF this is standard compile functions
	if(alasql.stdlib[funcid]) {
		if(this.args && this.args.length > 0) {
			s += alasql.stdlib[funcid].apply(this, this.args.map(function(arg) {return arg.toJavaScript(context, tableid)}));
		} else {
			s += alasql.stdlib[funcid]();
		}
	} else {
	// This is user-defined run-time function
	// TODO arguments!!!
		var s = 'alasql.userlib.'+this.funcid.substr(1).toLowerCase()+'(';
//		if(this.args) s += this.args.toJavaScript(context, tableid);
		s += this.args.map(function(arg){
			return arg.toJavaScript(context, tableid);
		}).join(',');
		s += ')';
	}
//console.log('userfn:',s,this);

//	if(this.alias) s += ' AS '+this.alias;
	return s;
}

// // Functions compiler
// nodes.FunctionValue.prototype.toJavaScript = function (context, tableid) {
// 	var s = '';
// 	s += fns[this.name.toUpperCase()].apply(null,this.arguments.map(function(arg){
// 		if(arg) return arg.toJavaScript(context, tableid);
// 		else return '';
// 	}));
// 	return s;
// };

// 
// SQL FUNCTIONS COMPILERS
// Based on SQLite functions

// IMPORTANT: These are compiled functions

alasql.fn = {}; // Keep for compatibility
alasql.userlib = alasql.fn;

var stdlib = alasql.stdlib = {}

stdlib._abs = function(a) {return 'Math.abs('+a+')'};
stdlib._iif = function(a,b,c) {
	if(arguments.length == 3) {
		return  '(('+a+')?('+b+'):('+c+'))';
	} else {
		throw new Error('Number of arguments of IFF is not equals to 3');
	};
};
stdlib._ifnull = function(a,b) {return '('+a+'||'+b+')'};
stdlib._instr = function(s,p) {return '(('+s+').indexOf('+p+')+1)'};

stdlib._len = function(s) {return '('+s+').length';};
stdlib._length = function(s) {return '('+s+').length'};

stdlib._lower = function(s) {return '('+s+').toLowerCase()';}
stdlib._lcase = function(s) {return '('+s+').toLowerCase()';}


// LTRIM
stdlib._max = function(){return 'Math.max('+arguments.join(',')+')'};
stdlib._min = function(){return 'Math.min('+arguments.join(',')+')'};
stdlib._mid = function(a,b,c){
	if(arguments.length == 2) return '('+a+').substr('+b+'-1)';
	else if(arguments.length == 3) return '('+a+').substr('+b+'-1,'+c+')';
};

stdlib._now = function(){return '(new Date())';};
stdlib._nullif = function(a,b){return '('+a+'=='+b+'?null:'+a+')'};

stdlib._round = function(s,d) {
	if(arguments.length == 2) {
		return 'Math.round('+s+'*Math.pow(10,'+d+'))/Math.pow(10,'+d+')';
	} else {
		return 'Math.round('+s+')';
	}
}
stdlib._upper = function(s) {return '('+s+').toUpperCase()';}
stdlib._ucase = function(s) {return '('+s+').toUpperCase()';}
//REPLACE
// RTRIM
// SUBSTR
// TRIM
//REPLACE
// RTRIM
// SUBSTR
// TRIM


/*
//
// CASE for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.CaseValue = function(params) { return yy.extend(this, params); };
yy.CaseValue.prototype.toString = function() {
	var s = 'CASE ';
	if(this.expression) s += this.expression.toString();
	if(this.whens) {
		s += this.whens.map(function(w) { return ' WHEN '+
			w.when.toString() + ' THEN '+w.then.toString()}).join();
	}
	s += ' END';
	return s;
};
yy.CaseValue.prototype.toJavaScript = function(context, tableid) {

	var s = '(function(p,params,alasql){var r;';
	if(this.expression) {
//			this.expression.toJavaScript(context, tableid)
		s += 'v='+this.expression.toJavaScript(context, tableid)+';';
		s += (this.whens||[]).map(function(w) { return ' if(v=='+w.when.toJavaScript(context,tableid)
			+') {r='+w.then.toJavaScript(context,tableid)+'}'; }).join(' else ');
		if(this.elses) s += ' else {r='+this.elses.toJavaScript(context,tableid)+'}';
	} else {
		s += (this.whens||[]).map(function(w) { return ' if('+w.when.toJavaScript(context,tableid)
			+') {r='+w.then.toJavaScript(context,tableid)+'}'; }).join(' else ');
		if(this.elses) s += ' else {r='+this.elses.toJavaScript(context,tableid)+'}';
	}
	s += 'return r;})(p,params,alasql)';

	return s;
};

/*
//
// CREATE TABLE for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.ColumnDef = function (params) { return yy.extend(this, params); }
yy.ColumnDef.prototype.toString = function() {
	var s =  this.columnid;
	if(this.dbtypeid) s += ' '+this.dbtypeid;
	if(this.dbsize) {
		s += '('+this.dbsize;
		if(this.dbprecision) s += ','+this.dbprecision;
		s += ')';
	};
	if(this.primarykey) s += ' PRIMARY KEY';
	if(this.notnull) s += ' NOT NULL';
	return s;
}

yy.CreateTable = function (params) { return yy.extend(this, params); }
yy.CreateTable.prototype.toString = function() {
	var s = 'CREATE';
	if(this.temporary) s+=' TEMPORARY';
	s += ' TABLE';
	if(this.ifnotexists) s += ' IF NOT EXISTS';
	s += ' '+this.table.toString();
	if(this.as) s += ' AS '+this.as;
	else { 
		var ss = this.columns.map(function(col){
			return col.toString();
		});
		s += ' ('+ss.join(',')+')';
	}
	return s;
}

// CREATE TABLE
yy.CreateTable.prototype.compile = function (db) {
//	var self = this;
	var tableid = this.table.tableid;
	var ifnotexists = this.ifnotexists;
	var columns = this.columns;
	var constraints = this.constraints||[];
//	console.log(this);

	return function() {

		if(!ifnotexists || ifnotexists && !db.tables[tableid]) {


			if(db.tables[tableid]) 
				throw new Error('Can not create table \''+tableid
					+'\', because it already exists in the database \''+db.databaseid+'\'');

			var table = db.tables[tableid] = {}; // TODO Can use special object?
			table.columns = [];
			table.xcolumns = {};
			table.indices = {};
			table.data = [];

			columns.forEach(function(col) {
				var newcol = {
					columnid: col.columnid.toLowerCase(),
					dbtypeid: col.dbtypeid.toUpperCase() // TODO: Add types table
				};
				table.columns.push(newcol);
				table.xcolumns[newcol.columnid] = newcol;

				// Check for primary key
				if(col.primarykey) {
					var pk = table.pk = {};
					pk.columns = [col.columnid];
					pk.onrightfns = 'r[\''+col.columnid+'\']';
					pk.onrightfn = new Function("r",'return '+pk.onrightfns);
					pk.hh = hash(pk.onrightfns);
					table.indices[pk.hh] = {};
				};

			});

			constraints.forEach(function(con) {
				//console.log(con, con.columns);
				if(con.type == 'PRIMARY KEY') {
					if(table.pk) {
						throw new Error('Primary key already exists');
					}
					var pk = table.pk = {};
					pk.columns = con.columns;
					pk.onrightfns = pk.columns.map(function(columnid){
						return 'r[\''+columnid+'\']'
					}).join("+'`'+");
					pk.onrightfn = new Function("r",'return '+pk.onrightfns);
					pk.hh = hash(pk.onrightfns);
					table.indices[pk.hh] = {};					
				}
			});

//			if(table.pk) {
				table.insert = function(r) {
					if(this.pk) {
						var pk = this.pk;
						var addr = pk.onrightfn(r);
						if(typeof this.indices[pk.hh][addr] != 'undefined') {
							throw new Error('Cannot insert record, because it already exists in primary key');
						} else {
							table.data.push(r);
							this.indices[pk.hh][addr]=r;
						};
					} else {
						table.data.push(r);						
					}
				};

				table.delete = function(i) {
					if(this.pk) {
						var r = this.data[i];
						var pk = this.pk;
						var addr = pk.onrightfn(r);
						if(typeof this.indices[pk.hh][addr] == 'undefined') {
							throw new Error('Something wrong with index on table');
						} else {
							this.indices[pk.hh][addr]=undefined;
						};
					}
				};

				table.deleteall = function() {
					this.data.length = 0;
					if(this.pk) {
//						var r = this.data[i];
						this.indices[this.pk.hh] = {};
					}
				};

				table.update = function(assignfn, i, params) {
					if(this.pk) {
						var r = this.data[i];
						var pk = this.pk;
						var addr = pk.onrightfn(r,params);
						if(typeof this.indices[pk.hh][addr] == 'undefined') {
							throw new Error('Something wrong with index on table');
						} else {
							this.indices[pk.hh][addr]=undefined;
							assignfn(r);
							var newaddr = pk.onrightfn(r);
							if(typeof this.indices[pk.hh][newaddr] != 'undefined') {
								throw new Error('Record already exists');
							} else {
								this.indices[pk.hh][newaddr] = r;
							}
						} 

					} else {
						assignfn(this.data[i]);
					};

				};


//			}
			return 1;
		};
		return 0;
	};
};




/*
//
// DROP TABLE for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.DropTable = function (params) { return yy.extend(this, params); }
yy.DropTable.prototype.toString = function() {
	var s = 'DROP TABLE';
	if(this.ifexists) s += ' IF EXISTS';
	s += ' '+this.table.toString();
	return s;
}


// DROP TABLE
yy.DropTable.prototype.compile = function (db) {
	var ifexists = this.ifexists;
	var tableid = this.table.tableid;
	return function() {
		if(!ifexists || ifexists && db.tables[tableid]) {
			if(!db.tables[tableid]) throw new Error('Can not drop table \''+this.target.value+'\', because it does not exist in the database.');
			delete db.tables[tableid];
		}
		return 1;
	}
};


/*
//
// ALTER TABLE for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// ALTER TABLE table1 RENAME TO table2
yy.AlterTable = function (params) { return yy.extend(this, params); }
yy.AlterTable.prototype.toString = function() {
	var s = 'ALTER TABLE '+this.table.toString(); 
	if(this.renameto) s += ' RENAME TO '+this.renameto;
	return s;
}

yy.AlterTable.prototype.compile = function (db) {
	var oldtableid = this.table.tableid;
	var newtableid = this.renameto;
	return function(params, cb) {
		var res = 1;
		if(db.tables[newtableid]) {
			throw new Error("Can not rename a table '"+oldtableid+"' to '"
				+newtableid+"', because the table with this name already exists");
		} else if(newtableid == oldtableid) {
			throw new Error("Can not rename a table '"+oldtableid+"' to itself");
		} else {
			db.tables[newtableid] = db.tables[oldtableid];
			delete db.tables[oldtableid];
			res = 1;
		};
		if(cb) cb(res)
		return res;
	}
};



/*
//
// INSERT for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.Insert = function (params) { return yy.extend(this, params); }
yy.Insert.prototype.toString = function() {
	var s = 'INSERT INTO '+this.into.toString();
	if(this.columns) s += '('+this.columns.toString()+')';
	if(this.values) s += ' VALUES '+this.values.toString();
	if(this.select) s += ' '+this.select.toString();
	return s;
}

yy.Insert.prototype.compile = function (db) {
	var self = this;
//	console.log(self);
	var tableid = self.into.tableid;

	// Check, if this dirty flag is required
	var s = 'db.tables[\''+tableid+'\'].dirty=true;';


// INSERT INTO table VALUES
	if(this.values) {

		self.values.forEach(function(values) {

//			s += 'db.tables[\''+tableid+'\'].data.push({';

			s += 'var r={';
			var ss = [];
			if(self.columns) {
				self.columns.forEach(function(col, idx){
		//			ss.push(col.columnid +':'+ self.values[idx].value.toString());
		//			console.log(rec[f.name.value]);
		//			if(rec[f.name.value] == "NULL") rec[f.name.value] = undefined;

		//			if(table.xflds[f.name.value].dbtypeid == "INT") rec[f.name.value] = +rec[f.name.value]|0;
		//			else if(table.xflds[f.name.value].dbtypeid == "FLOAT") rec[f.name.value] = +rec[f.name.value];
					var q = col.columnid +':';
					// if(table.xcolumns && table.xcolumns[col.columnid] && 
					// 	( table.xcolumns[col.columnid].dbtypeid == "INT"
					// 		|| table.xcolumns[col.columnid].dbtypeid == "FLOAT"
					// 		|| table.xcolumns[col.columnid].dbtypeid == "NUMBER"
					// 		|| table.xcolumns[col.columnid].dbtypeid == "MONEY"
					// 	)) q += '+';
		//			console.log(self.values[idx].value);
					q += values[idx].toJavaScript();
					// if(table.xcolumns && table.xcolumns[col.columnid] && table.xcolumns[col.columnid].dbtypeid == "INT") q += '|0';
					ss.push(q);

				});
			} else {
				var table = db.tables[tableid];
		//		console.log('table', table.columns);
				table.columns.forEach(function(col, idx){
					var q = col.columnid +':';
					var val = values[idx].toJavaScript();

					 if(table.xcolumns && table.xcolumns[col.columnid] && 
					  (table.xcolumns[col.columnid].dbtypeid == "DATE" ||
						table.xcolumns[col.columnid].dbtypeid == "DATETIME"
					  )) {
					 	val = "(new Date("+val+"))";
					 }
					// 		|| table.xcolumns[col.columnid].dbtypeid == "FLOAT"
					// 		|| table.xcolumns[col.columnid].dbtypeid == "NUMBER"
					// 		|| table.xcolumns[col.columnid].dbtypeid == "MONEY"
					// 	)) q += '+';
				//	console.log(self.values[idx].toString());
		//console.log(self);
					q += val;

					// if(table.xcolumns && table.xcolumns[col.columnid] && table.xcolumns[col.columnid].dbtypeid == "INT") q += '|0';
					ss.push(q);

		//			console.log(fld);
					// TODO: type checking and conversions
		//			rec[fld.fldid] = eval(self.insertExpression[idx].toJavaScript('',''));
		//			console.log(rec[fld.fldid]);
		//			if(rec[fld.fldid] == "NULL") rec[fld.fldid] = undefined;

		//			if(table.xflds[fld.fldid].dbtypeid == "INT") rec[fld.fldid] = +rec[fld.fldid]|0;
		//			else if(table.xflds[fld.fldid].dbtypeid == "FLOAT" || table.xflds[fld.fldid].dbtypeid == "MONEY" ) 
		//				rec[fld.fldid] = +rec[fld.fldid];
				});
			}

			s += ss.join(',')+'};';
			s += 'db.tables[\''+tableid+'\'].insert(r);';

		});

		s += 'return '+this.values.length;
		var insertfn = new Function('db, params',s);
	
// INSERT INTO table SELECT

	} else if(this.select) {
		selectfn = this.select.compile(db);
		var insertfn = function(db, params) {
			var res = selectfn(params);
			db.tables[tableid].data = db.tables[tableid].data.concat(res);
			return res.length;
		}
	}


	return function(params, cb) {
		var res = insertfn(db, params);
		if(cb) cb(res);
		return res;
	}
};





/*
//
// DELETE for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.Delete = function (params) { return yy.extend(this, params); }
yy.Delete.prototype.toString = function() {
	var s = 'DELETE FROM '+this.table.toString();
	if(this.where) s += ' WHERE '+this.where.toString();
	return s;
}

yy.Delete.prototype.compile = function (db) {
//  console.log(11,this);

	var tableid = this.table.tableid;

	if(this.where) {
//		try {
//		console.log(this, 22, this.where.toJavaScript('r',''));
//	} catch(err){console.log(444,err)};
		var wherefn = new Function('r,params','return ('+this.where.toJavaScript('r','')+')');
//		console.log(wherefn);
		return function (params, cb) {
			var table = db.tables[tableid];
			table.dirty = true;
			var orignum = table.data.length;

			var newtable = [];			
			for(var i=0, ilen=table.data.length;i<ilen;i++) {
				if(wherefn(table.data[i],params)) {
					// Check for transaction - if it is not possible then return all back
					table.delete(i);
				} else newtable.push(table.data[i]);
			}
//			table.data = table.data.filter(function(r){return !;});
			table.data = newtable;
//			console.log('deletefn',table.data.length);
			if(cb) cb(orignum - table.data.length);
			return orignum - table.data.length;
		}
	} else {
		return function (params, cb) {
			var table = db.tables[tableid];
			table.dirty = true;
			var orignum = db.tables[tableid].data.length;

			table.deleteall();

			if(cb) cb(orignum);
			return orignum;
		};
	}

};


/*
//
// UPDATE for Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

yy.Update = function (params) { return yy.extend(this, params); }
yy.Update.prototype.toString = function() {
	var s = 'UPDATE '+this.table.toString();
	if(this.columns) s += ' SET '+this.columns.toString();
	if(this.where) s += ' WHERE '+this.where.toString();
	return s;
}


yy.SetColumn = function (params) { return yy.extend(this, params); }
yy.SetColumn.prototype.toString = function() {
	return this.columnid.toString() + '='+this.expression.toString();
}

yy.Update.prototype.compile = function (db) {
//	console.log(this);

	var tableid = this.table.tableid;
	
	if(this.where) {
		var wherefn = new Function('r,params','return '+this.where.toJavaScript('r',''));
	};

	// Construct update function
	var s = '';
	this.columns.forEach(function(col){
		s += 'r.'+col.columnid+'='+col.expression.toJavaScript('r','')+';'; 
	});
	var assignfn = new Function('r,params',s);

	return function(params, cb) {
		var table = db.tables[tableid];
		if(!table) {
			throw new Error("Table '"+tableid+"' not exists")
		}
		table.dirty = true;
		var numrows = 0;
		for(var i=0, ilen=table.data.length; i<ilen; i++) {
			if(!wherefn || wherefn(table.data[i], params) ) {
				table.update(assignfn, i, params);
				numrows++;
			}
		};
		if(cb) cb(numrows);
		return numrows;
	};
};






// Console functions

alasql.con = {
	results:{}
};

alasql.con.open = function(el) {
	// For browser only
	if (typeof exports === 'object') return;

	// Find parent element
	el = el || document.getElementById('alasql-con') || document.getElementsByTagName('body');
	if(!el) {throw new Error('Cannot fid element for console.')}

	var conel = document.createElement('div');
	conel.style.width = "1000px";
	conel.style.height = "320px";

	alasql.con.conel = conel;

	var lenta = document.createElement('div');
	lenta.style.width = "1000px";
	lenta.style.height = "200px";
	lenta.style.overflow = "scroll";
	alasql.con.lenta = lenta;

	var inpel = document.createElement('div');
	inpel.style.width = "1000px";
	inpel.style.height = "100px";
	inpel.style.contentEditable = true;
	inpel.innerHTML = 'command ';
	alasql.con.inpel = inpel;

	conel.appendChild(lenta);
	conel.appendChild(inpel);
	el.appendChild(conel);
};

alasql.con.clear = function() {
	// For browser only
	if (typeof exports === 'object') return;

	alasql.con.conel.innerHTML = '';
};

alasql.con.close = function() {
	// For browser only
	if (typeof exports === 'object') return;

	alasql.con.conel.removeChild(alasql.con.lenta);
	alasql.con.conel.removeChild(alasql.con.inel);
	alasql.con.conel.parentElement.removeChild(conel);
};

alasql.con.log = function() {
		// For browser only
	if (typeof exports === 'object') {
		console.log.bind(console).apply(this, arguments);
	} else {
		var s = '<div>';
		s += Array.prototype.slice.call(arguments, 0).map(function(arg){
			return arg.toString();
		}).join(' ');
		s += '</div>';
		alasql.con.conel.innerHTML += s;
	};

};

alasql.con.test = function(name, times, fn) {
	if(arguments.length == 0) {
		alasql.con.log(alasql.con.results);
		return;
	} else if(arguments.length == 1) {
		var tm = Date.now();
		fn();
		alasql.con.log(Date.now()-tm);
		return;
	} 

	if(arguments.length == 2) {
		fn = times;
		times = 1;
	}

	var tm = Date.now();
	for(var i=0;i<times;i++) fn();
	alasql.con.results[name] = Date.now()-tm;
};



/*
//
// Last part of Alasql.js
// Date: 03.11.2014
// (c) 2014, Andrey Gershun
//
*/

// End of module

return alasql;
}));


//# sourceMappingURL=alasql.js.map